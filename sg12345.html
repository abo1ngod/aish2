<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --success: #27ae60;
            --danger: #c0392b;
            --bg-color: #f0f3f6;
            --card-bg: #ffffff;
            --gold: #f1c40f;
            --silver: #bdc3c7;
            --bronze: #cd7f32;
        }

        * { box-sizing: border-box; }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 0;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            user-select: none;
        }

        /* --- Ø§Ù„Ù‡ÙŠØ¯Ø± --- */
        .header-area {
            width: 100%;
            padding: 15px 20px;
            background: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
            position: sticky;
            top: 0;
        }

        .app-title {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* --- Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© (Ø§Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©) --- */
        .dashboard-container {
            width: 100%;
            max-width: 800px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .players-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            width: 100%;
        }

        .player-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            cursor: pointer;
            border: 2px solid transparent;
            transition: transform 0.2s, border-color 0.2s;
            position: relative;
            overflow: hidden;
        }

        .player-card:hover {
            transform: translateY(-5px);
            border-color: var(--accent);
        }

        .player-rank {
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 0.8rem;
            font-weight: bold;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            background: #95a5a6;
        }
        .rank-1 { background: var(--gold); box-shadow: 0 0 10px var(--gold); }
        .rank-2 { background: var(--silver); }
        .rank-3 { background: var(--bronze); }

        .player-name {
            font-size: 1.1rem;
            font-weight: bold;
            color: var(--primary);
            margin: 10px 0 5px 0;
        }

        .player-score {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--accent);
        }
        
        .play-btn {
            margin-top: 10px;
            background: #ecf0f1;
            color: var(--primary);
            border: none;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            width: 100%;
        }
        .player-card:hover .play-btn { background: var(--accent); color: white; }

        /* --- Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© (Ø¯Ø§Ø®Ù„ÙŠØ©) --- */
        .game-section {
            display: none; /* Ù…Ø®ÙÙŠØ© Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
            width: 100%;
            height: 100vh;
            position: fixed;
            top: 0;
            left: 0;
            background: var(--bg-color);
            z-index: 200;
            flex-direction: column;
            align-items: center;
        }

        .game-header {
            width: 100%;
            padding: 15px;
            background: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .back-btn {
            background: none; border: none; font-size: 1.5rem; cursor: pointer;
        }

        /* Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙØ© */
        .target-word {
            font-size: 5.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-top: 40px;
            opacity: 0;
            transform: scale(0.5);
            transition: all 0.3s;
            min-height: 140px; 
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .target-word.visible { opacity: 1; transform: scale(1); }
        .target-word.correct { color: var(--success); animation: pop 0.3s; }
        .target-word.wrong { color: var(--danger); animation: shake 0.4s; }
        
        @keyframes pop { 50% { transform: scale(1.2); } }
        @keyframes shake { 25% { transform: translateX(-10px); } 75% { transform: translateX(10px); } }

        /* Ø´Ø±ÙŠØ· Ø§Ù„ØªÙˆÙ‚ÙŠØª */
        .timer-container {
            width: 80%;
            max-width: 400px;
            height: 12px;
            background: #ddd;
            border-radius: 6px;
            margin: 20px 0;
            overflow: hidden;
            display: none;
        }
        .timer-bar { height: 100%; width: 100%; background: var(--accent); }

        /* Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø³Ø±Ø¹Ø© */
        .mode-selection {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            margin-top: 50px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 400px;
        }
        .mode-btn {
            display: block;
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            border: 2px solid #eee;
            background: white;
            border-radius: 10px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            position: relative;
        }
        .mode-btn span { float: left; font-weight: bold; }
        .mode-btn small { float: right; color: #7f8c8d; }
        
        .mode-rocket { border-color: #e74c3c; color: #c0392b; }
        .mode-fast { border-color: #f39c12; color: #d35400; }
        .mode-normal { border-color: #27ae60; color: #27ae60; }
        
        .mode-rocket:hover, .mode-rocket.active { background: #e74c3c; color: white; }
        .mode-fast:hover, .mode-fast.active { background: #f39c12; color: white; }
        .mode-normal:hover, .mode-normal.active { background: #27ae60; color: white; }

        .start-btn-big {
            background: var(--primary);
            color: white;
            font-size: 1.5rem;
            padding: 15px 40px;
            border-radius: 50px;
            border: none;
            margin-top: 20px;
            width: 100%;
            cursor: pointer;
        }

        /* --- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© --- */
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 2000; justify-content: center; align-items: center;
        }
        .modal-content {
            background: white; width: 95%; max-width: 500px; border-radius: 15px; padding: 20px;
            max-height: 90vh; overflow-y: auto;
        }
        
        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© */
        .tabs { display: flex; gap: 10px; margin-bottom: 15px; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        .tab-btn { flex: 1; padding: 10px; background: #eee; border: none; border-radius: 8px; cursor: pointer; }
        .tab-btn.active { background: var(--primary); color: white; }

        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        td, th { padding: 8px; border-bottom: 1px solid #eee; text-align: right; }
        
        .mic-status { position: absolute; top: 20px; left: 20px; font-size: 1.5rem; opacity: 0.2; }
        .mic-active { opacity: 1; color: var(--danger); animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }

    </style>
</head>
<body>

    <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ -->
    <div class="header-area">
        <div class="app-title">ğŸ† Ø¯ÙˆØ±ÙŠ Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø©</div>
        <!-- Ø§Ù„Ø¢Ù† ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙŠÙƒÙˆÙ† Ø¨Ø¹Ø¯ 5 Ù†Ù‚Ø±Ø§Øª Ù…ØªØªØ§Ù„ÙŠØ© Ø¶Ù…Ù† Ù†Ø§ÙØ°Ø© Ø²Ù…Ù†ÙŠØ© Ù‚ØµÙŠØ±Ø© -->
        <button id="admin-gear" onclick="openAdmin()" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">âš™ï¸</button>
    </div>

    <!-- 1. Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© (Dashboard) -->
    <div class="dashboard-container" id="dashboard">
        <div style="background: #e8f6f3; padding: 15px; border-radius: 10px; border: 1px solid #d1f2eb; color: #0e6655; font-size: 0.9rem; margin-bottom: 10px;">
            â„¹ï¸ Ø§Ø®ØªØ± Ø§Ø³Ù…Ùƒ Ù„Ø¨Ø¯Ø¡ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©. Ø§Ù„Ù†Ù‚Ø§Ø· ØªØªØ±Ø§ÙƒÙ… Ù…Ø¹ ÙƒÙ„ Ø¬ÙˆÙ„Ø©!
        </div>
        <div class="players-grid" id="players-grid">
            <!-- Ø³ÙŠØªÙ… ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª Ù‡Ù†Ø§ -->
        </div>
    </div>

    <!-- 2. Ø´Ø§Ø´Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© (Game Screen) -->
    <div class="game-section" id="game-section">
        <div class="game-header">
            <button class="back-btn" onclick="exitGame()">âœ•</button>
            <div style="font-weight: bold; font-size: 1.2rem;">Ø§Ù„Ù„Ø§Ø¹Ø¨: <span id="active-player-name" style="color:var(--accent);">...</span></div>
            <div style="font-weight: bold;">Ù†Ù‚Ø§Ø· Ø§Ù„Ø¬ÙˆÙ„Ø©: <span id="round-score" style="color:var(--success);">0</span></div>
        </div>

        <!-- Ù…Ø¤Ø´Ø± Ø§Ù„Ù…ÙŠÙƒØ±ÙˆÙÙˆÙ† -->
        <div id="mic-icon" class="mic-status">ğŸ™ï¸</div>

        <!-- Ø£. Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªÙˆÙ‰ -->
        <div id="mode-selector" class="mode-selection">
            <h3>Ø§Ø®ØªØ± Ù…Ø³ØªÙˆÙ‰ Ø§Ù„ØªØ­Ø¯ÙŠ</h3>
            <button class="mode-btn mode-rocket" onclick="selectMode(3000, 3, this)">
                <span>ğŸš€ ØµØ§Ø±ÙˆØ® (3 Ø«ÙˆØ§Ù†)</span> <small>3 Ù†Ù‚Ø§Ø·</small>
            </button>
            <button class="mode-btn mode-fast" onclick="selectMode(5000, 2, this)">
                <span>ğŸ‡ Ø³Ø±ÙŠØ¹ (5 Ø«ÙˆØ§Ù†)</span> <small>2 Ù†Ù‚Ø·Ø©</small>
            </button>
            <button class="mode-btn mode-normal selected active" onclick="selectMode(7000, 1, this)">
                <span>ğŸ¢ Ø¹Ø§Ø¯ÙŠ (7 Ø«ÙˆØ§Ù†)</span> <small>1 Ù†Ù‚Ø·Ø©</small>
            </button>
            
            <button class="start-btn-big" onclick="startGame()">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø¬ÙˆÙ„Ø©</button>
        </div>

        <!-- Ø¨. Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ù†Ø´Ø·Ø© -->
        <div id="active-game-area" style="display: none; width: 100%; flex-direction: column; align-items: center;">
            <div id="word-display" class="target-word">...</div>
            
            <div class="timer-container" id="timer-container">
                <div class="timer-bar" id="timer-bar"></div>
            </div>

            <div id="feedback-text" style="font-size: 1.5rem; font-weight: bold; height: 40px; margin-top: 20px;"></div>
            
            <div style="margin-top: 30px; color: #95a5a6; font-size: 0.9rem; border: 1px solid #ddd; padding: 5px 15px; border-radius: 20px;">
                Ø³Ù…Ø¹Øª: <span id="heard-text">...</span>
            </div>
        </div>
    </div>

    <!-- Ù†ÙˆØ§ÙØ° Ù…Ù†Ø¨Ø«Ù‚Ø© -->
    
    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© -->
    <div id="end-modal" class="modal-overlay">
        <div class="modal-content" style="text-align: center;">
            <h1 style="font-size: 4rem; margin: 0;">ğŸ‰</h1>
            <h2>Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬ÙˆÙ„Ø©!</h2>
            <p>Ø£Ø¶ÙØª Ù„Ø±ØµÙŠØ¯Ùƒ:</p>
            <div style="font-size: 3rem; font-weight: bold; color: var(--success);" id="final-round-points">+0</div>
            <button class="start-btn-big" onclick="finishSession()">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ØªØ±ØªÙŠØ¨</button>
        </div>
    </div>

    <!-- Ø§Ø­ØªÙØ¸Ù†Ø§ Ø¨ØµÙ†Ø¯ÙˆÙ‚ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ù„ÙƒÙ† Ø£Ø²Ù„Ù†Ø§ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù…Ù†Ù‡ ÙƒÙ…Ø§ Ø·ÙÙ„Ø¨ -->
    <div id="pass-modal" class="modal-overlay">
        <div class="modal-content" style="max-width: 300px; text-align: center;">
            <h3>Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h3>
            <input type="password" id="admin-pass" placeholder="Ø§Ù„Ø±Ù…Ø²" style="width: 100%; padding: 10px; text-align: center; font-size: 1.2rem; margin-bottom: 10px; border:1px solid #ddd; border-radius:8px;">
            <button onclick="checkPass()" style="width: 100%; padding: 10px; background: var(--primary); color: white; border: none; border-radius: 8px;">Ø¯Ø®ÙˆÙ„</button>
            <button onclick="document.getElementById('pass-modal').style.display='none'" style="margin-top: 10px; background: none; border: none; color: #7f8c8d; cursor: pointer;">Ø¥Ù„ØºØ§Ø¡</button>
        </div>
    </div>

    <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© -->
    <div id="admin-modal" class="modal-overlay">
        <div class="modal-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <h3 style="margin:0">âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
                <button onclick="document.getElementById('admin-modal').style.display='none'" style="background:var(--danger); color:white; border:none; width:30px; height:30px; border-radius:50%; cursor:pointer;">âœ•</button>
            </div>

            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('players', event)">Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ†</button>
                <button class="tab-btn" onclick="switchTab('words', event)">Ø§Ù„ÙƒÙ„Ù…Ø§Øª</button>
            </div>

            <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† -->
            <div id="tab-players">
                <button onclick="resetAllScores()" style="width:100%; padding:10px; background:var(--danger); color:white; border:none; border-radius:8px; margin-bottom:10px;">âš ï¸ ØªØµÙÙŠØ± Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¬Ù…ÙŠØ¹</button>
                <div style="max-height: 300px; overflow-y: auto;">
                    <table id="admin-players-table">
                        <!-- ÙŠØ¹Ø¨Ø£ Ø¨Ø§Ù„Ø¬Ø§ÙØ§Ø³ÙƒØ±Ø¨Øª -->
                    </table>
                </div>
            </div>

            <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ÙƒÙ„Ù…Ø§Øª -->
            <div id="tab-words" style="display:none;">
                <div style="display:flex; gap:5px; margin-bottom:10px;">
                    <input type="text" id="new-word-in" placeholder="ÙƒÙ„Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©..." style="flex:1; padding:8px; border:1px solid #ddd; border-radius:4px;">
                    <button onclick="addWord()" style="background:var(--success); color:white; border:none; padding:0 15px; border-radius:4px;">+</button>
                </div>
                <div style="max-height: 300px; overflow-y: auto;">
                    <table id="admin-words-table"></table>
                </div>
                <button onclick="resetWords()" style="margin-top:10px; width:100%; padding:8px; background:#95a5a6; color:white; border:none; border-radius:4px;">Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø£ØµÙ„ÙŠØ©</button>
            </div>

        </div>
    </div>

    <!-- Firebase scripts (Ø·Ø¨Ù‚ Ù…Ø§ Ø·Ù„Ø¨Øª) -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyBxPO6RKsQ1Cq-mqlCpFTrCuIyxnYdB37U",
        authDomain: "studentsystem-c1ab1.firebaseapp.com",
        databaseURL: "https://studentsystem-c1ab1-default-rtdb.firebaseio.com",
        projectId: "studentsystem-c1ab1",
        storageBucket: "studentsystem-c1ab1.firebasestorage.app",
        messagingSenderId: "112215023848",
        appId: "1:112215023848:web:0adba326a527ee7e37e95d"
      };
      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }
      const db = firebase.database();
      const rootRef = db.ref('aish_1');
    </script>

    <script>
        // --- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ---
        const DEFAULT_PLAYERS = ["Ø¨Ø¯Ø±ÙŠØ©", "Ù†Ø¬ÙˆØ¯", "Ø£Ù…Ø¬Ø§Ø¯", "Ø£Ù†Ø³", "ÙŠØ§Ø³Ø±", "ÙˆØ¬Ø¯Ø§Ù†", "Ù…Ø§Ø¬Ø¯", "Ø¹Ø§Ø¦Ø´"];
        let players = [];
        let wordBank = [];
        
        // --- Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù„Ø¹Ø¨ ---
        let activePlayerIndex = null;
        let selectedTimeMs = 7000;
        let pointsPerWord = 1; 
        let currentRoundScore = 0; 
        let roundQueue = [];
        let currentWordIndex = 0;
        let timerInterval = null;
        let recognition;
        let isGameRunning = false;
        let currentTargetWord = "";

        // Ø¹Ø¯Ø¯ Ù†Ù‚Ø±Ø§Øª Ø§Ù„ØªØ±Ø³
        let adminClickCount = 0;
        let adminClickTimer = null;

        // --- ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù†Ø¸Ø§Ù… ---
        function init() {
            loadData();
            setupSpeech();
            renderDashboard();
            // Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„ØªØ­Ø¯ÙŠØ«Ø§Øª Ù…Ù† Firebase Ø¥Ù† ÙˆÙØ¬Ø¯Øª - Ù„Ø§ ØªØ¤Ø«Ø± Ø¥Ù† Ù„Ù… ØªØªÙˆÙØ± ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø´Ø¨ÙƒØ©
            try {
                rootRef.child('players').on('value', snap => {
                    const val = snap.val();
                    if (val) {
                        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ø§Ù„Ø±ÙŠØ§Ù„ØªØ§ÙŠÙ… Ù…ÙˆØ¬ÙˆØ¯Ø©ØŒ Ø§Ø³ØªØ¨Ø¯Ù„ Ø§Ù„Ù…Ø­Ù„Ù‘ÙŠØ©
                        players = Array.isArray(val) ? val : Object.values(val);
                        savePlayersToLocalOnly();
                        renderDashboard();
                    }
                });
                rootRef.child('words').on('value', snap => {
                    const val = snap.val();
                    if (val) { wordBank = Array.isArray(val) ? val : Object.values(val); saveWordsToLocalOnly(); }
                });
            } catch(e) { /* ØªÙ‡Ù…ÙŠØ´ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ù„Ùˆ Ù„Ù… ØªÙØ­Ù…Ù‘ÙÙ„ firebase */ }
        }

        function loadData() {
            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ† Ù…Ù† localStorage
            const savedPlayers = localStorage.getItem('speedRead_players');
            if (savedPlayers) {
                players = JSON.parse(savedPlayers);
            } else {
                players = DEFAULT_PLAYERS.map((name, index) => ({
                    id: index,
                    name: name,
                    totalScore: 0
                }));
                savePlayersToLocalOnly();
            }

            // ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙ„Ù…Ø§Øª (Ù…ÙØªØ§Ø­ Ø¬Ø¯ÙŠØ¯ Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªØ­Ø¯ÙŠØ«)
            const savedWords = localStorage.getItem('speedRead_words_v6');
            if (savedWords) wordBank = JSON.parse(savedWords);
            else generateDefaultWords();

            // Ø­Ø§ÙˆÙ„ Ø¬Ù„Ø¨ Ù…Ù† Firebase Ø¥Ù† Ø£Ù…ÙƒÙ† (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©) - Ù„Ù† ÙŠÙˆÙ‚Ù Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù„Ùˆ ÙØ´Ù„
            try {
                rootRef.child('players').once('value').then(snap => {
                    const val = snap.val();
                    if (val) {
                        players = Array.isArray(val) ? val : Object.values(val);
                        savePlayersToLocalOnly();
                        renderDashboard();
                    }
                }).catch(()=>{});
                rootRef.child('words').once('value').then(snap => {
                    const val = snap.val();
                    if (val) { wordBank = Array.isArray(val) ? val : Object.values(val); saveWordsToLocalOnly(); }
                }).catch(()=>{});
            } catch(e) {}
        }

        function savePlayers() {
            // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ Ø«Ù… Ø¯ÙØ¹ Ø¥Ù„Ù‰ Firebase
            savePlayersToLocalOnly();
            try { rootRef.child('players').set(players); } catch(e) {}
            renderDashboard();
        }
        function savePlayersToLocalOnly() {
            localStorage.setItem('speedRead_players', JSON.stringify(players));
        }

        function saveWords() {
            saveWordsToLocalOnly();
            try { rootRef.child('words').set(wordBank); } catch(e) {}
        }
        function saveWordsToLocalOnly() {
            localStorage.setItem('speedRead_words_v6', JSON.stringify(wordBank));
        }

        function generateDefaultWords() {
            // 200 ÙƒÙ„Ù…Ø© Ù…Ù†Ù‚Ø­Ø© (3-5 Ø£Ø­Ø±Ù)
            const defaults = [
                "Ø£Ø³Ø¯", "Ù†Ù…Ø±", "ÙÙ‡Ø¯", "Ø°Ø¦Ø¨", "Ø¯Ø¨", "Ø«Ø¹Ù„Ø¨", "ÙƒÙ„Ø¨", "Ù‚Ø·Ø©", "Ù‚Ø±Ø¯", "ÙÙŠÙ„",
                "Ø¬Ù…Ù„", "Ø¨Ù‚Ø±", "ØºÙ†Ù…", "Ù…Ø§Ø¹Ø²", "Ø®ÙŠÙ„", "Ø­ØµØ§Ù†", "Ø­Ù…Ø§Ø±", "Ø£Ø±Ù†Ø¨", "Ø¸Ø¨ÙŠ", "ØºØ²Ø§Ù„",
                "Ø¨Ø·Ø©", "ÙˆØ²Ø©", "Ø¯ÙŠÙƒ", "Ø¯Ø¬Ø§Ø¬", "ØµÙ‚Ø±", "Ù†Ø³Ø±", "Ø¨ÙˆÙ…Ø©", "Ù‡Ø¯Ù‡Ø¯", "Ø­Ù…Ø§Ù…Ø©", "ÙŠÙ…Ø§Ù…Ø©",
                "Ø³Ù…Ùƒ", "Ø­ÙˆØª", "Ù‚Ø±Ø´", "Ø¶ÙØ¯Ø¹", "Ù†Ù…Ù„Ø©", "Ù†Ø­Ù„Ø©", "ÙØ±Ø§Ø´Ø©", "Ø¯ÙˆØ¯Ø©", "Ø­ÙŠØ©", "ÙØ£Ø±",
                "Ø¹ØµÙÙˆØ±", "Ø¨Ù„Ø¨Ù„", "ØºØ±Ø§Ø¨", "Ø­ÙˆØª", "Ø³Ù…Ùƒ", 
                "Ø´Ù…Ø³", "Ù‚Ù…Ø±", "Ù†Ø¬Ù…", "Ø³Ù…Ø§Ø¡", "Ø£Ø±Ø¶", "Ø¨Ø­Ø±", "Ù†Ù‡Ø±", "Ø¬Ø¨Ù„", "ØªÙ„", "ÙˆØ§Ø¯ÙŠ",
                "ØµØ®Ø±", "Ø­Ø¬Ø±", "Ø±Ù…Ù„", "ØªØ±Ø§Ø¨", "ØºÙŠÙ…", "Ø³Ø­Ø§Ø¨", "Ù…Ø·Ø±", "Ø«Ù„Ø¬", "Ø¨Ø±Ø¯", "Ø±ÙŠØ­",
                "Ù‡ÙˆØ§Ø¡", "Ù†ÙˆØ±", "Ø¸Ù„Ø§Ù…", "Ù„ÙŠÙ„", "Ù†Ù‡Ø§Ø±", "ÙØ¬Ø±", "ØµØ¨Ø­", "Ø¹ØµØ±", "Ø²Ù‡Ø±", "ÙˆØ±Ø¯",
                "Ø´Ø¬Ø±", "Ù†Ø®Ù„", "Ø¹Ø´Ø¨", "ØºØ§Ø¨Ø©", "Ø­Ù‚Ù„", "Ø¨Ø¦Ø±", "ÙƒÙ‡Ù", "Ø¨Ø±Ù‚", "Ø±Ø¹Ø¯",
                "Ø±Ø£Ø³", "ÙˆØ¬Ù‡", "Ø´Ø¹Ø±", "Ø¹ÙŠÙ†", "Ø£Ø°Ù†", "Ø£Ù†Ù", "ÙÙ…", "Ù„Ø³Ø§Ù†", "Ø³Ù†", "Ø¶Ø±Ø³",
                "Ø¹Ù†Ù‚", "ÙƒØªÙ", "ÙŠØ¯", "ÙƒÙ", "Ø¥ØµØ¨Ø¹", "Ø¸ÙØ±", "Ø¨Ø·Ù†", "Ø¸Ù‡Ø±", "Ù‚Ù„Ø¨", "Ø¯Ù…",
                "Ø¹Ø¸Ù…", "Ø¬Ù„Ø¯", "Ø±Ø¬Ù„", "Ù‚Ø¯Ù…", "Ø±ÙƒØ¨Ø©", "ÙƒØ¹Ø¨", "ØµØ¯Ø±",
                "Ø®Ø¨Ø²", "Ù„Ø­Ù…", "Ø£Ø±Ø²", "Ø³Ù…Ùƒ", "Ø¨ÙŠØ¶", "Ø¬Ø¨Ù†", "Ø²Ø¨Ø¯", "Ø¹Ø³Ù„", "Ø³Ù…Ù†", "Ø²ÙŠØª",
                "Ù…Ù„Ø­", "Ø³ÙƒØ±", "Ù…Ø§Ø¡", "Ù„Ø¨Ù†", "Ø­Ù„ÙŠØ¨", "Ø´Ø§ÙŠ", "Ø¨Ù†", "ØªÙ…Ø±", "Ø±Ø·Ø¨", "Ø¹Ù†Ø¨",
                "ØªÙŠÙ†", "ØªÙˆØª", "ÙƒØ±Ø²", "Ù…ÙˆØ²", "ØªÙØ§Ø­", "Ø®ÙˆØ®", "Ù…Ø´Ù…Ø´", "Ø¬Ø²Ø±", "Ø¨ØµÙ„", "Ø«ÙˆÙ…",
                "ÙÙˆÙ„", "Ø¹Ø¯Ø³", "Ù‚Ù…Ø­", "Ø°Ø±Ø©", "ÙØ¬Ù„", "Ø®ÙŠØ§Ø±", "Ù„ÙŠÙ…ÙˆÙ†", "Ø¨Ø·ÙŠØ®", "ÙƒØ¹Ùƒ", "Ø­Ù„ÙˆÙ‰",
                "Ù‚Ù„Ù…", "ÙƒØªØ§Ø¨", "Ø¯ÙØªØ±", "ÙˆØ±Ù‚", "Ø­Ù‚ÙŠØ¨Ø©", "Ø´Ù†Ø·Ø©", "ÙØµÙ„", "ØµÙ", "Ù„ÙˆØ­", "Ø¯Ø±Ø³",
                "Ø¹Ù„Ù…", "Ø±Ø³Ù…", "Ù„ÙˆÙ†", "Ø­Ø¨Ø±", "Ù…Ø³Ø·Ø±Ø©", "Ø¨Ø±Ø§ÙŠØ©", "Ù…Ù‚Ø¹Ø¯", "Ø·Ø§ÙˆÙ„Ø©", "ÙƒØ±Ø³ÙŠ", "Ø¬Ø±Ø³",
                "Ø³Ø§Ø­Ø©", "Ø·Ø§Ù„Ø¨", "Ù…Ø¹Ù„Ù…", "Ù…Ø¯ÙŠØ±", "Ø¹Ø¯Ø¯", "Ø±Ù‚Ù…", "Ø­Ø±Ù", "ÙƒÙ„Ù…Ø©", "Ø³Ø·Ø±", "ØµÙˆØ±Ø©",
                "Ø¨ÙŠØª", "Ø¯Ø§Ø±", "Ø¨Ø§Ø¨", "Ø´Ø¨Ø§Ùƒ", "Ø¬Ø¯Ø§Ø±", "Ø³Ù‚Ù", "ØºØ±ÙØ©", "Ù…Ø·Ø¨Ø®", "Ø­Ù…Ø§Ù…", "Ø³Ø±ÙŠØ±",
                "ÙØ±Ø´", "Ù„Ø­Ø§Ù", "Ù…Ø®Ø¯Ø©", "ØµÙ†Ø¯ÙˆÙ‚", "ÙƒÙˆØ¨", "ØµØ­Ù†", "Ù…Ù„Ø¹Ù‚Ø©", "Ø´ÙˆÙƒØ©", "Ø³Ø§Ø¹Ø©", "Ù…ÙØªØ§Ø­",
                "Ù‚ÙÙ„", "Ø®ÙŠØ·", "Ø¥Ø¨Ø±Ø©", "Ø«ÙˆØ¨", "Ù‚Ù…ÙŠØµ", "Ø­Ø°Ø§Ø¡", "Ø¬ÙˆØ±Ø¨", "Ù‚Ø¨Ø¹Ø©", "Ù…Ø±Ø¢Ø©", "Ù…Ø´Ø·",
                "ØµØ§Ø¨ÙˆÙ†", "Ø³ÙƒÙŠÙ†", "Ù‚Ø¯Ø±", "Ù†Ø§Ø±",
                "Ø£Ø¨", "Ø£Ù…", "Ø£Ø®", "Ø£Ø®Øª", "Ø¬Ø¯", "Ø¬Ø¯Ø©", "Ø¹Ù…", "Ø¹Ù…Ø©", "Ø®Ø§Ù„", "Ø®Ø§Ù„Ø©",
                "Ø·ÙÙ„", "ÙˆÙ„Ø¯", "Ø¨Ù†Øª", "Ø±Ø¬Ù„", "Ø¬Ø§Ø±", "ØµØ¯ÙŠÙ‚", "Ø·Ø¨ÙŠØ¨", "Ø´Ø±Ø·ÙŠ", "Ø®Ø¨Ø§Ø²", "Ù†Ø¬Ø§Ø±",
                "Ø­Ø¯Ø§Ø¯", "Ø®ÙŠØ§Ø·", "ØªØ§Ø¬Ø±", "Ø¬Ù†Ø¯ÙŠ", "Ù…Ù„Ùƒ", "Ø£Ù…ÙŠØ±", "Ø¥Ù…Ø§Ù…",
                "Ù…Ø³Ø¬Ø¯", "Ù…Ø¯Ø±Ø³Ø©", "Ø³ÙˆÙ‚", "Ø´Ø§Ø±Ø¹", "Ø·Ø±ÙŠÙ‚", "Ø¬Ø³Ø±", "Ø­Ø¯ÙŠÙ‚Ø©", "Ù…Ù„Ø¹Ø¨", "Ù…Ø¯ÙŠÙ†Ø©", "Ù‚Ø±ÙŠØ©",
                "Ø¨Ù„Ø¯", "ÙˆØ·Ù†", "Ù…ÙƒØ©", "Ù‚Ø¯Ø³", "Ù…ØµØ±",
                "ÙŠÙˆÙ…", "Ø´Ù‡Ø±", "Ø³Ù†Ø©", "Ø¹Ø§Ù…", "ÙˆÙ‚Øª", "Ø²Ù…Ù†", "Ø¹ÙŠØ¯", "ØµÙŠÙ", "Ø´ØªØ§Ø¡", "Ø±Ø¨ÙŠØ¹",
                "Ø®Ø±ÙŠÙ", "ÙØ±Ø­", "Ø­Ø²Ù†", "Ø­Ø¨", "Ø®ÙŠØ±", "Ø´Ø±", "ØµÙ„Ø§Ø©", "ØµÙˆÙ…", "Ø­Ø¬", "Ø°ÙƒØ±",
                "ÙÙƒØ±", "Ø¹Ù‚Ù„", "Ø±ÙˆØ­", "Ù†ÙØ³"
            ];
            // ØªØµÙÙŠØ© Ù„Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø·ÙˆÙ„ ÙˆØ¹Ø¯Ù… Ø§Ù„ØªÙƒØ±Ø§Ø±
            wordBank = [...new Set(defaults)].filter(w => w.length >= 3 && w.length <= 5);
            saveWordsToLocalOnly();
        }

        // --- Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø© ---
        function renderDashboard() {
            const grid = document.getElementById('players-grid');
            grid.innerHTML = "";

            // Ø§Ù„ØªØ±ØªÙŠØ¨: Ø§Ù„Ù†Ù‚Ø§Ø· ØªÙ†Ø§Ø²Ù„ÙŠØ§Ù‹ Ø£ÙˆÙ„Ø§Ù‹ØŒ Ø«Ù… Ø§Ù„Ø§Ø³Ù… Ø£Ø¨Ø¬Ø¯ÙŠØ§Ù‹ (ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„ØªØ¹Ø§Ø¯Ù„ Ø£Ùˆ Ø§Ù„Ù†Ù‚Ø§Ø· 0)
            const sortedPlayers = [...players].sort((a, b) => {
                // Ø§Ù„ÙØ±Ù‚ ÙÙŠ Ø§Ù„Ù†Ù‚Ø§Ø· (Ù„ØªØ±ØªÙŠØ¨ ØªÙ†Ø§Ø²Ù„ÙŠ)
                const scoreDiff = b.totalScore - a.totalScore;
                if (scoreDiff !== 0) return scoreDiff;
                
                // Ø¥Ø°Ø§ ØªØ³Ø§ÙˆØª Ø§Ù„Ù†Ù‚Ø§Ø·ØŒ Ø±ØªØ¨ Ø­Ø³Ø¨ Ø§Ù„Ø§Ø³Ù… Ø£Ø¨Ø¬Ø¯ÙŠØ§Ù‹
                return a.name.localeCompare(b.name, 'ar');
            });

            sortedPlayers.forEach((player) => {
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ÙÙ‡Ø±Ø³ Ø§Ù„Ø£ØµÙ„ÙŠ Ù„Ù„Ø§Ø¹Ø¨ ÙÙŠ Ø§Ù„Ù…ØµÙÙˆÙØ© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‡ ÙÙŠ selectPlayer
                const originalIndex = players.findIndex(p => p.id === player.id);
                
                // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±ØªØ¨Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±ØªØ¨Ø©
                const rank = sortedPlayers.indexOf(player) + 1;

                let rankClass = "";
                if (rank === 1) rankClass = "rank-1";
                else if (rank === 2) rankClass = "rank-2";
                else if (rank === 3) rankClass = "rank-3";

                // Ø´Ø±Ø· Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ±ØªÙŠØ¨: Ø£Ù† ÙŠÙƒÙˆÙ† Ø¶Ù…Ù† Ø§Ù„Ø«Ù„Ø§Ø«Ø© Ø§Ù„Ø£ÙˆØ§Ø¦Ù„ ÙˆØ£Ù† ØªÙƒÙˆÙ† Ø§Ù„Ù†Ù‚Ø§Ø· Ø£ÙƒØ¨Ø± Ù…Ù† ØµÙØ±
                const showRank = rank <= 3 && player.totalScore > 0;

                grid.innerHTML += `
                    <div class="player-card" onclick="selectPlayer(${originalIndex})">
                        ${showRank ? `<div class="player-rank ${rankClass}">${rank}</div>` : ''}
                        <div style="font-size:3rem;">ğŸ‘¤</div>
                        <div class="player-name">${player.name}</div>
                        <div class="player-score">${player.totalScore}</div>
                        <div style="font-size:0.8rem; color:#95a5a6;">Ù†Ù‚Ø·Ø©</div>
                        <button class="play-btn">Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù„Ø¹Ø¨ â–¶</button>
                    </div>
                `;
            });
        }

        // --- Ù…Ù†Ø·Ù‚ Ø§Ù„Ù„Ø¹Ø¨Ø© ---
        function selectPlayer(idx) {
            activePlayerIndex = idx;
            document.getElementById('active-player-name').innerText = players[idx].name;
            document.getElementById('dashboard').style.display = 'none'; // Ø¥Ø®ÙØ§Ø¡ Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©
            document.getElementById('game-section').style.display = 'flex'; // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„Ù„Ø¹Ø¨Ø©
            
            // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
            document.getElementById('mode-selector').style.display = 'block';
            document.getElementById('active-game-area').style.display = 'none';
        }

        function selectMode(ms, points, btn) {
            selectedTimeMs = ms;
            pointsPerWord = points;
            
            // ØªØ­Ø¯ÙŠØ« Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function startGame() {
            if (wordBank.length < 10) { alert("Ù„Ø§ ØªÙˆØ¬Ø¯ ÙƒÙ„Ù…Ø§Øª ÙƒØ§ÙÙŠØ©!"); return; }

            // Ø¥Ø®ÙØ§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙˆØ¶Ø¹ ÙˆØ¥Ø¸Ù‡Ø§Ø± Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨
            document.getElementById('mode-selector').style.display = 'none';
            document.getElementById('active-game-area').style.display = 'flex';
            document.getElementById('timer-container').style.display = 'block';

            currentRoundScore = 0;
            currentWordIndex = 0;
            updateGameUI();
            
            // Ø§Ø®ØªÙŠØ§Ø± 10 ÙƒÙ„Ù…Ø§Øª Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
            const shuffled = [...wordBank].sort(() => 0.5 - Math.random());
            roundQueue = shuffled.slice(0, 10);

            isGameRunning = true;
            try { recognition.start(); } catch(e) {}
            
            nextRound();
        }

        function nextRound() {
            if (currentWordIndex >= 10) { endGame(); return; }

            const wordEl = document.getElementById('word-display');
            wordEl.className = "target-word"; // Ø¥Ø²Ø§Ù„Ø© ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ù„Ø£Ù„ÙˆØ§Ù†
            wordEl.classList.remove('visible');
            wordEl.innerText = "";
            document.getElementById('feedback-text').innerText = "";

            setTimeout(() => {
                currentTargetWord = roundQueue[currentWordIndex];
                wordEl.innerText = currentTargetWord;
                wordEl.classList.add('visible');
                startTimer();
            }, 500);
        }

        function startTimer() {
            const bar = document.getElementById('timer-bar');
            bar.style.transition = 'none';
            bar.style.width = '100%';
            void bar.offsetWidth; // Reflow
            bar.style.transition = `width ${selectedTimeMs}ms linear`;
            bar.style.width = '0%';

            clearTimeout(timerInterval);
            timerInterval = setTimeout(() => {
                handleResult(false);
            }, selectedTimeMs);
        }

        function handleResult(isCorrect) {
            clearTimeout(timerInterval);
            const wordEl = document.getElementById('word-display');
            const feedback = document.getElementById('feedback-text');

            if (isCorrect) {
                currentRoundScore += pointsPerWord;
                wordEl.classList.add('correct');
                feedback.innerText = `ØµØ­! (+${pointsPerWord})`;
                feedback.style.color = "var(--success)";
            } else {
                currentRoundScore -= pointsPerWord; // Ø§Ù„Ø®ØµÙ… Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
                wordEl.classList.add('wrong');
                feedback.innerText = `Ø®Ø·Ø£! (-${pointsPerWord})`;
                feedback.style.color = "var(--danger)";
            }

            updateGameUI();
            currentWordIndex++;
            setTimeout(nextRound, 1500);
        }

        function updateGameUI() {
            document.getElementById('round-score').innerText = currentRoundScore;
        }

        function endGame() {
            isGameRunning = false;
            try { recognition.stop(); } catch(e) {}
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ© Ù„Ù„Ø§Ø¹Ø¨
            players[activePlayerIndex].totalScore += currentRoundScore;
            savePlayers();

            document.getElementById('final-round-points').innerText = (currentRoundScore >= 0 ? "+" : "") + currentRoundScore;
            document.getElementById('end-modal').style.display = 'flex';
        }

        function finishSession() {
            document.getElementById('end-modal').style.display = 'none';
            exitGame();
        }

        function exitGame() {
            isGameRunning = false;
            try { recognition.stop(); } catch(e) {}
            clearTimeout(timerInterval);
            
            document.getElementById('game-section').style.display = 'none';
            document.getElementById('dashboard').style.display = 'flex'; // Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ù‚ÙŠØ§Ø¯Ø©
            renderDashboard(); // Ù„ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø·
        }

        // --- Ø§Ù„ØªØ¹Ø±Ù Ø§Ù„ØµÙˆØªÙŠ ---
        function setupSpeech() {
            if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                const SpeechAPI = window.SpeechRecognition || window.webkitSpeechRecognition;
                recognition = new SpeechAPI();
                recognition.lang = 'ar-SA';
                recognition.continuous = true;
                recognition.interimResults = true;

                recognition.onstart = () => document.getElementById('mic-icon').classList.add('mic-active');
                recognition.onend = () => {
                    document.getElementById('mic-icon').classList.remove('mic-active');
                    if (isGameRunning) recognition.start();
                };
                recognition.onresult = (e) => {
                    const txt = e.results[e.results.length - 1][0].transcript;
                    document.getElementById('heard-text').innerText = txt;
                    checkVoice(txt);
                };
            } else { alert("Ø§Ù„Ù…ØªØµÙØ­ ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…"); }
        }

        function checkVoice(spoken) {
            if (!isGameRunning || !currentTargetWord) return;
            // ØªØ·Ø¨ÙŠØ¹ Ø¨Ø³ÙŠØ·
            let s = spoken.trim().replace(/[Ø£Ø¥Ø¢]/g, 'Ø§').replace(/Ø©/g, 'Ù‡').replace(/Ù‰/g, 'ÙŠ');
            let t = currentTargetWord.trim().replace(/[Ø£Ø¥Ø¢]/g, 'Ø§').replace(/Ø©/g, 'Ù‡').replace(/Ù‰/g, 'ÙŠ');
            
            if (s.includes(t)) handleResult(true);
        }

        // --- Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ---
        function openAdmin() {
            // ÙŠØªÙ… ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø¹Ø¯ 5 Ù†Ù‚Ø±Ø§Øª Ø³Ø±ÙŠØ¹Ø© Ø¹Ù„Ù‰ Ø§Ù„ØªØ±Ø³ Ø¯Ø§Ø®Ù„ Ù†Ø§ÙØ°Ø© Ø²Ù…Ù†ÙŠØ© Ù‚ØµÙŠØ±Ø©
            adminClickCount++;
            // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ù„Ù„Ù…Ø¤Ù‚Øª
            if (adminClickTimer) clearTimeout(adminClickTimer);
            adminClickTimer = setTimeout(() => { adminClickCount = 0; }, 1400); // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¹Ø¯ Ø¨Ø¹Ø¯ 1.4 Ø«Ø§Ù†ÙŠØ© Ù…Ù† Ø¢Ø®Ø± Ù†Ù‚Ø±Ø©

            if (adminClickCount === 5) {
                adminClickCount = 0;
                // Ø¥ÙØªØ­ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… Ù…Ø¨Ø§Ø´Ø±Ø©
                renderAdminPlayers();
                renderAdminWords();
                document.getElementById('admin-modal').style.display = 'flex';
            }
            // ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ù†Ù‚Ø±Ø§Øª Ø§Ù„Ø²Ø§Ø¦Ø¯Ø© Ø¨Ø¯ÙˆÙ† Ø£Ù† ÙŠØ³Ø¨Ø¨ ØªÙ‡Ù†ÙŠÙ‚
        }
        function checkPass() {
            // Ù„Ù… ÙŠØ¹Ø¯ Ù‡Ù†Ø§Ùƒ Ø±Ù…Ø² Ø§ÙØªØ±Ø§Ø¶ÙŠØŒ Ø§Ø­ØªÙØ¸Ù†Ø§ Ø¨Ø§Ù„Ù…Ø±Ø¨Ø¹ Ù„ÙƒÙ† Ù„Ø§ Ù†ÙØ±Ø¶ 1234
            const val = document.getElementById('admin-pass').value;
            if (!val) { alert('Ø§Ù„Ø±Ù…Ø² ÙØ§Ø±Øº'); return; }
            // ÙÙŠ Ø­Ø§Ù„ Ø±ØºØ¨Øª Ø¨ÙØ­Øµ Ø§Ù„Ø±Ù…Ø² Ù…Ù† Ù‚Ø§Ø¹Ø¯Ø© Ø¨ÙŠØ§Ù†Ø§ØªØŒ ÙŠÙ…ÙƒÙ† Ø§Ø¶Ø§ÙØªÙ‡ Ù„Ø§Ø­Ù‚Ø§Ù‹
            document.getElementById('pass-modal').style.display = 'none';
            renderAdminPlayers();
            renderAdminWords();
            document.getElementById('admin-modal').style.display = 'flex';
        }
        
        function switchTab(tab, evt) {
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.querySelectorAll('[id^="tab-"]').forEach(d => d.style.display = 'none');
            
            if(tab === 'players') {
                document.getElementById('tab-players').style.display = 'block';
                renderAdminPlayers();
            } else {
                document.getElementById('tab-words').style.display = 'block';
                renderAdminWords();
            }
            if(evt && evt.target) evt.target.classList.add('active');
        }

        function renderAdminPlayers() {
            const tbl = document.getElementById('admin-players-table');
            tbl.innerHTML = "";
            players.forEach((p, idx) => {
                tbl.innerHTML += `
                    <tr>
                        <td><input type="text" value="${p.name}" onchange="updatePlayerName(${idx}, this.value)" style="width:100%; padding:5px;"></td>
                        <td style="font-weight:bold; color:var(--accent);">${p.totalScore}</td>
                        <td><button onclick="resetPlayerScore(${idx})" style="background:#e74c3c; color:white; border:none; border-radius:4px; padding:2px 8px;">ØªØµÙÙŠØ±</button></td>
                    </tr>
                `;
            });
        }
        
        function updatePlayerName(idx, val) { if(val) { players[idx].name = val; savePlayers(); renderDashboard(); } }
        function resetPlayerScore(idx) { players[idx].totalScore = 0; savePlayers(); renderAdminPlayers(); renderDashboard(); }
        function resetAllScores() { if(confirm("ØªØµÙÙŠØ± Ø§Ù„Ø¬Ù…ÙŠØ¹ØŸ")) { players.forEach(p => p.totalScore = 0); savePlayers(); renderAdminPlayers(); renderDashboard(); } }

        function renderAdminWords() {
            const tbl = document.getElementById('admin-words-table'); tbl.innerHTML = "";
            wordBank.forEach((w, i) => {
                tbl.innerHTML += `<tr><td><input value="${w}" onchange="editWord(${i}, this.value)" style="width:100%; padding:6px; border:1px solid #ddd; border-radius:4px;"></td><td><button onclick="delWord(${i})" style="color:red; background:none; border:none;">âœ•</button></td></tr>`;
            });
        }
        function editWord(i, val) { if(val) { wordBank[i] = val; saveWords(); renderAdminWords(); } }
        function addWord() {
            const v = document.getElementById('new-word-in').value;
            if(v) { wordBank.unshift(v); saveWords(); renderAdminWords(); document.getElementById('new-word-in').value = ""; }
        }
        function delWord(i) { wordBank.splice(i, 1); saveWords(); renderAdminWords(); }
        function resetWords() { if(confirm("Ø§Ø³ØªØ¹Ø§Ø¯Ø©ØŸ")) { generateDefaultWords(); renderAdminWords(); } }

        // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ´ØºÙŠÙ„
        init();

    </script>
</body>
</html> 