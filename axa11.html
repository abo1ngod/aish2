<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ØªØ­Ø¯ÙŠ Ø§Ù„Ø¹Ø¨Ø§Ù‚Ø±Ø© - Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø°Ù‡Ù†ÙŠ</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Tajawal', 'sans-serif'],
                    },
                    colors: {
                        primary: '#6C63FF',
                        secondary: '#FF6584',
                        success: '#00B894',
                        warning: '#FDCB6E',
                        danger: '#FF7675',
                        dark: '#2D3436'
                    },
                    animation: {
                        'bounce-short': 'bounce 1s infinite',
                        'pulse-fast': 'pulse 1s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f3f4f6;
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }

        .tab-active {
            background-color: white;
            color: #4F46E5;
            border-bottom: 4px solid #4F46E5;
            font-weight: bold;
        }

        .tab-inactive {
            background-color: #E5E7EB;
            color: #6B7280;
            border-bottom: 4px solid transparent;
        }

        .tab-inactive:hover {
            background-color: #D1D5DB;
        }

        /* Timer Bar Animation */
        .timer-container {
            width: 100%;
            height: 10px;
            background-color: #E5E7EB;
            border-radius: 9999px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .timer-bar {
            height: 100%;
            background: linear-gradient(90deg, #FF6584, #FF7675);
            width: 100%;
            transform-origin: right;
            transition: width linear;
        }

        /* Option Button Styles */
        .option-btn {
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .option-btn:active {
            transform: translateY(2px);
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        /* Animations */
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .pop-in {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- App Container -->
    <div class="bg-white w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden relative min-h-[600px] flex flex-col">
        
        <!-- Header -->
        <header class="bg-indigo-600 text-white p-4 text-center">
            <h1 class="text-2xl font-black tracking-wide"><i class="fas fa-brain ml-2"></i>ØªØ­Ø¯ÙŠ Ø§Ù„Ø¹Ø¨Ø§Ù‚Ø±Ø©</h1>
        </header>

        <!-- Main Content Area -->
        <main class="flex-grow relative p-6">
            
            <!-- HOME SCREEN (Settings) -->
            <div id="homeScreen" class="flex flex-col gap-6 h-full">
                
                <!-- Tabs -->
                <div class="flex rounded-lg overflow-hidden border border-gray-200 text-lg">
                    <button onclick="switchTab('add')" id="tab-add" class="flex-1 py-3 tab-active transition-colors duration-200">
                        <i class="fas fa-plus ml-2"></i> Ø§Ù„Ø¬Ù…Ø¹
                    </button>
                    <button onclick="switchTab('mult')" id="tab-mult" class="flex-1 py-3 tab-inactive transition-colors duration-200">
                        <i class="fas fa-times ml-2"></i> Ø§Ù„Ø¶Ø±Ø¨
                    </button>
                </div>

                <div class="space-y-6 mt-4">
                    <!-- Range Selection -->
                    <div class="bg-indigo-50 p-4 rounded-xl border border-indigo-100">
                        <label class="block text-indigo-900 font-bold mb-2"><i class="fas fa-sort-numeric-up-alt ml-2"></i>Ù…Ø¬Ø§Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…:</label>
                        <div class="grid grid-cols-2 gap-4">
                            <label class="cursor-pointer">
                                <input type="radio" name="range" value="5" class="peer sr-only" checked>
                                <div class="bg-white peer-checked:bg-indigo-500 peer-checked:text-white peer-checked:border-indigo-600 border border-gray-300 rounded-lg p-3 text-center transition-all shadow-sm">
                                    Ù…Ù† 0 Ø¥Ù„Ù‰ 5
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="range" value="9" class="peer sr-only">
                                <div class="bg-white peer-checked:bg-indigo-500 peer-checked:text-white peer-checked:border-indigo-600 border border-gray-300 rounded-lg p-3 text-center transition-all shadow-sm">
                                    Ø§Ù„ÙƒÙ„ (0-9)
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Speed Selection -->
                    <div class="bg-pink-50 p-4 rounded-xl border border-pink-100">
                        <label class="block text-pink-900 font-bold mb-2"><i class="fas fa-stopwatch ml-2"></i>Ø³Ø±Ø¹Ø© Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©:</label>
                        <div class="grid grid-cols-3 gap-2">
                            <label class="cursor-pointer">
                                <input type="radio" name="speed" value="3" class="peer sr-only">
                                <div class="bg-white peer-checked:bg-pink-500 peer-checked:text-white border border-gray-300 rounded-lg p-2 text-center text-sm font-bold transition-all shadow-sm">
                                    3 Ø«ÙˆØ§Ù†ÙŠ âš¡
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="speed" value="5" class="peer sr-only" checked>
                                <div class="bg-white peer-checked:bg-pink-500 peer-checked:text-white border border-gray-300 rounded-lg p-2 text-center text-sm font-bold transition-all shadow-sm">
                                    5 Ø«ÙˆØ§Ù†ÙŠ ğŸ‡
                                </div>
                            </label>
                            <label class="cursor-pointer">
                                <input type="radio" name="speed" value="7" class="peer sr-only">
                                <div class="bg-white peer-checked:bg-pink-500 peer-checked:text-white border border-gray-300 rounded-lg p-2 text-center text-sm font-bold transition-all shadow-sm">
                                    7 Ø«ÙˆØ§Ù†ÙŠ ğŸ¢
                                </div>
                            </label>
                        </div>
                    </div>

                    <!-- Count Selection -->
                    <div class="bg-green-50 p-4 rounded-xl border border-green-100">
                        <label class="block text-green-900 font-bold mb-2"><i class="fas fa-list-ol ml-2"></i>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª:</label>
                        <select id="qCount" class="w-full p-3 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-green-500 bg-white">
                            <option value="5">5 Ø¹Ù…Ù„ÙŠØ§Øª</option>
                            <option value="10" selected>10 Ø¹Ù…Ù„ÙŠØ§Øª</option>
                            <option value="20">20 Ø¹Ù…Ù„ÙŠØ©</option>
                        </select>
                    </div>
                </div>

                <button onclick="startGame()" class="mt-auto w-full bg-indigo-600 hover:bg-indigo-700 text-white font-black py-4 rounded-xl text-xl shadow-lg transform hover:scale-[1.02] transition-all">
                    Ø§Ø¨Ø¯Ø£ Ø§Ù„ØªØ­Ø¯ÙŠ! ğŸš€
                </button>
            </div>

            <!-- GAME SCREEN -->
            <div id="gameScreen" class="hidden flex-col h-full justify-between pop-in">
                <!-- Status Bar -->
                <div class="flex justify-between items-center text-gray-600 font-bold mb-4">
                    <span class="bg-gray-200 px-3 py-1 rounded-full text-sm"><span id="currentQNum">1</span> / <span id="totalQNum">10</span></span>
                    <span class="bg-indigo-100 text-indigo-700 px-3 py-1 rounded-full text-sm">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="scoreDisplay">0</span></span>
                </div>

                <!-- Timer -->
                <div class="timer-container relative">
                    <div id="timerBar" class="timer-bar"></div>
                </div>

                <!-- Question Area -->
                <div class="flex-grow flex flex-col items-center justify-center mb-6">
                    <div class="text-gray-400 text-sm font-bold mb-2 tracking-widest">Ø§Ù„Ù…Ø³Ø£Ù„Ø©</div>
                    <div class="bg-white border-4 border-dashed border-indigo-200 rounded-3xl p-8 w-full text-center shadow-sm">
                        <div id="questionText" class="text-6xl font-black text-gray-800 dir-ltr" style="direction: ltr;">
                            <!-- populated by js -->
                        </div>
                    </div>
                </div>

                <!-- Options Grid -->
                <div id="optionsGrid" class="grid grid-cols-2 gap-4 mb-4">
                    <!-- Buttons will be injected here -->
                </div>

                <!-- Feedback Overlay (Absolute) -->
                <div id="feedbackOverlay" class="absolute inset-0 bg-white/95 z-10 flex flex-col items-center justify-center hidden rounded-lg">
                    <div id="feedbackIcon" class="text-6xl mb-4"></div>
                    <div id="feedbackText" class="text-2xl font-black mb-2"></div>
                    <div id="feedbackSub" class="text-gray-500"></div>
                </div>
            </div>

        </main>
    </div>

    <!-- RESULT MODAL -->
    <div id="resultModal" class="fixed inset-0 modal-overlay hidden z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-3xl shadow-2xl w-full max-w-sm p-8 text-center transform scale-100 transition-transform">
            <div class="mb-4">
                <i class="fas fa-trophy text-yellow-400 text-6xl drop-shadow-md animate-bounce-short"></i>
            </div>
            <h2 class="text-3xl font-black text-gray-800 mb-2">Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬ÙˆÙ„Ø©!</h2>
            <p id="finalMessage" class="text-gray-500 mb-6 font-bold">Ø£Ø¯Ø§Ø¡ Ø±Ø§Ø¦Ø¹!</p>
            
            <div class="bg-gray-100 rounded-xl p-4 mb-6">
                <div class="text-sm text-gray-500 mb-1">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©</div>
                <div class="text-4xl font-black text-indigo-600"><span id="finalScore">0</span> / <span id="finalTotal">10</span></div>
            </div>

            <div class="space-y-3">
                <button onclick="restartGame()" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl shadow-md transition-colors">
                    <i class="fas fa-redo-alt ml-2"></i> Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©
                </button>
                <button onclick="goHome()" class="w-full bg-gray-200 hover:bg-gray-300 text-gray-700 font-bold py-3 rounded-xl transition-colors">
                    <i class="fas fa-home ml-2"></i> Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- State Management ---
        const state = {
            mode: 'add', // 'add' or 'mult'
            rangeMax: 5,
            timeLimit: 5,
            totalQuestions: 10,
            currentQuestionIndex: 0,
            score: 0,
            timerId: null,
            isAnswering: false
        };

        // --- DOM Elements ---
        const screens = {
            home: document.getElementById('homeScreen'),
            game: document.getElementById('gameScreen'),
            modal: document.getElementById('resultModal')
        };
        const els = {
            tabAdd: document.getElementById('tab-add'),
            tabMult: document.getElementById('tab-mult'),
            qCount: document.getElementById('qCount'),
            timerBar: document.getElementById('timerBar'),
            qText: document.getElementById('questionText'),
            optsGrid: document.getElementById('optionsGrid'),
            currentQ: document.getElementById('currentQNum'),
            totalQ: document.getElementById('totalQNum'),
            score: document.getElementById('scoreDisplay'),
            feedback: document.getElementById('feedbackOverlay'),
            fbIcon: document.getElementById('feedbackIcon'),
            fbText: document.getElementById('feedbackText'),
            fbSub: document.getElementById('feedbackSub'),
            finalScore: document.getElementById('finalScore'),
            finalTotal: document.getElementById('finalTotal'),
            finalMsg: document.getElementById('finalMessage')
        };

        // --- Setup & Configuration ---
        function switchTab(mode) {
            state.mode = mode;
            if (mode === 'add') {
                els.tabAdd.className = 'flex-1 py-3 tab-active transition-colors duration-200';
                els.tabMult.className = 'flex-1 py-3 tab-inactive transition-colors duration-200';
            } else {
                els.tabAdd.className = 'flex-1 py-3 tab-inactive transition-colors duration-200';
                els.tabMult.className = 'flex-1 py-3 tab-active transition-colors duration-200';
            }
        }

        function startGame() {
            // Get Settings
            const rangeRadio = document.querySelector('input[name="range"]:checked');
            state.rangeMax = parseInt(rangeRadio.value);
            
            const speedRadio = document.querySelector('input[name="speed"]:checked');
            state.timeLimit = parseInt(speedRadio.value);
            
            state.totalQuestions = parseInt(els.qCount.value);
            state.currentQuestionIndex = 0;
            state.score = 0;

            // UI Update
            screens.home.classList.add('hidden');
            screens.game.classList.remove('hidden');
            screens.game.classList.add('flex');
            screens.modal.classList.add('hidden');
            
            updateScoreBoard();
            nextQuestion();
        }

        function updateScoreBoard() {
            els.currentQ.textContent = state.currentQuestionIndex + 1;
            els.totalQ.textContent = state.totalQuestions;
            els.score.textContent = state.score;
        }

        // --- Game Logic ---
        function generateQuestion() {
            let num1 = Math.floor(Math.random() * (state.rangeMax + 1)); // 0 to Max
            let num2 = Math.floor(Math.random() * (state.rangeMax + 1)); // 0 to Max
            let correctAnswer;
            let symbol;

            if (state.mode === 'add') {
                correctAnswer = num1 + num2;
                symbol = '+';
            } else {
                correctAnswer = num1 * num2;
                symbol = 'Ã—';
            }

            // Generate distractors (wrong answers)
            let options = new Set();
            options.add(correctAnswer);

            while (options.size < 4) {
                let wrong;
                // Generate somewhat plausible wrong answers
                let offset = Math.floor(Math.random() * 5) - 2; // -2 to +2
                if (state.mode === 'add') {
                    wrong = correctAnswer + offset;
                    // Ensure non-negative if desired, though -ve is math. Let's stick to 0+ for simplicity unless user is clever.
                    // For kids, let's keep it simple. If wrong < 0, make it absolute.
                    if (wrong < 0) wrong = Math.abs(wrong);
                } else {
                    // Multiplication distractors
                    wrong = (Math.floor(Math.random() * (state.rangeMax + 1))) * (Math.floor(Math.random() * (state.rangeMax + 1)));
                    // Or close numbers
                    if (Math.random() > 0.5) wrong = correctAnswer + offset;
                    if (wrong < 0) wrong = 0;
                }

                if (wrong !== correctAnswer) {
                    options.add(wrong);
                }
            }

            return {
                text: `${num1} ${symbol} ${num2}`,
                correct: correctAnswer,
                options: Array.from(options).sort(() => Math.random() - 0.5) // Shuffle
            };
        }

        function nextQuestion() {
            if (state.currentQuestionIndex >= state.totalQuestions) {
                endGame();
                return;
            }

            state.isAnswering = false;
            els.feedback.classList.add('hidden');
            updateScoreBoard();
            
            const q = generateQuestion();
            els.qText.textContent = q.text;

            // Render Options
            els.optsGrid.innerHTML = '';
            q.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'option-btn bg-white border-2 border-indigo-100 hover:border-indigo-500 hover:bg-indigo-50 text-indigo-900 font-black text-2xl py-4 rounded-xl';
                btn.textContent = opt;
                btn.onclick = () => checkAnswer(opt, q.correct);
                els.optsGrid.appendChild(btn);
            });

            startTimer();
        }

        function startTimer() {
            if (state.timerId) clearTimeout(state.timerId);
            
            // Reset Animation
            els.timerBar.style.transition = 'none';
            els.timerBar.style.width = '100%';
            
            // Force reflow
            void els.timerBar.offsetWidth;

            // Start Animation
            els.timerBar.style.transition = `width ${state.timeLimit}s linear`;
            els.timerBar.style.width = '0%';

            state.timerId = setTimeout(() => {
                handleTimeout();
            }, state.timeLimit * 1000);
        }

        function checkAnswer(selected, correct) {
            if (state.isAnswering) return;
            state.isAnswering = true;
            clearTimeout(state.timerId);
            
            // Pause timer animation visually
            const computedStyle = window.getComputedStyle(els.timerBar);
            const width = computedStyle.getPropertyValue('width');
            els.timerBar.style.transition = 'none';
            els.timerBar.style.width = width;

            if (selected === correct) {
                state.score++;
                showFeedback(true, false);
            } else {
                showFeedback(false, false);
            }
        }

        function handleTimeout() {
            if (state.isAnswering) return;
            state.isAnswering = true;
            showFeedback(false, true);
        }

        function showFeedback(isCorrect, isTimeout) {
            els.feedback.classList.remove('hidden');
            
            if (isCorrect) {
                els.fbIcon.innerHTML = 'ğŸ‰';
                els.fbText.textContent = 'Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!';
                els.fbText.className = 'text-3xl font-black mb-2 text-green-600';
                els.fbSub.textContent = getRandomPraise();
                playSound('correct');
            } else if (isTimeout) {
                els.fbIcon.innerHTML = 'â°';
                els.fbText.textContent = 'Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚Øª!';
                els.fbText.className = 'text-3xl font-black mb-2 text-orange-500';
                els.fbSub.textContent = 'Ø­Ø§ÙˆÙ„ Ø£Ù† ØªÙƒÙˆÙ† Ø£Ø³Ø±Ø¹ ÙÙŠ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©';
                playSound('wrong');
            } else {
                els.fbIcon.innerHTML = 'ğŸ¤”';
                els.fbText.textContent = 'Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©';
                els.fbText.className = 'text-3xl font-black mb-2 text-red-500';
                els.fbSub.textContent = 'Ø±ÙƒØ² Ø¬ÙŠØ¯Ø§Ù‹ØŒ Ø£Ù†Øª ØªØ³ØªØ·ÙŠØ¹ ÙØ¹Ù„Ù‡Ø§!';
                playSound('wrong');
            }

            // Wait then move to next
            setTimeout(() => {
                state.currentQuestionIndex++;
                nextQuestion();
            }, 1500);
        }

        function getRandomPraise() {
            const praises = ["ÙŠØ§ Ø¨Ø·Ù„!", "Ø¹Ø¨Ù‚Ø±ÙŠ!", "Ù…Ù…ØªØ§Ø²!", "Ø§Ø³ØªÙ…Ø± Ù‡ÙƒØ°Ø§!", "Ø±Ø§Ø¦Ø¹ Ø¬Ø¯Ø§Ù‹!"];
            return praises[Math.floor(Math.random() * praises.length)];
        }

        function playSound(type) {
            // Optional: Simple beep or synth. 
            // Browsers block auto-audio often, keeping it silent for simplicity/reliability
            // unless user interaction is guaranteed.
        }

        function endGame() {
            screens.game.classList.add('hidden');
            screens.game.classList.remove('flex');
            screens.modal.classList.remove('hidden');

            els.finalScore.textContent = state.score;
            els.finalTotal.textContent = state.totalQuestions;

            const percentage = (state.score / state.totalQuestions) * 100;
            if (percentage === 100) {
                els.finalMsg.textContent = "Ù…Ø°Ù‡Ù„! Ø¹Ù„Ø§Ù…Ø© ÙƒØ§Ù…Ù„Ø© ÙŠØ§ Ø¹Ø¨Ù‚Ø±ÙŠ ğŸŒŸ";
                els.finalMsg.className = "text-green-600 mb-6 font-bold text-lg";
            } else if (percentage >= 80) {
                els.finalMsg.textContent = "Ø¹Ù…Ù„ Ø±Ø§Ø¦Ø¹ Ø¬Ø¯Ø§Ù‹! Ø§Ù‚ØªØ±Ø¨Øª Ù…Ù† Ø§Ù„ÙƒÙ…Ø§Ù„ ğŸ’ª";
                els.finalMsg.className = "text-indigo-600 mb-6 font-bold text-lg";
            } else if (percentage >= 50) {
                els.finalMsg.textContent = "Ø¬ÙŠØ¯! ÙˆÙ„ÙƒÙ† ÙŠÙ…ÙƒÙ†Ùƒ ØªØ­Ù‚ÙŠÙ‚ Ø£ÙØ¶Ù„ Ù…Ù† Ø°Ù„Ùƒ ğŸ“š";
                els.finalMsg.className = "text-orange-500 mb-6 font-bold text-lg";
            } else {
                els.finalMsg.textContent = "Ù„Ø§ ØªÙŠØ£Ø³! Ø§Ù„ØªØ¯Ø±ÙŠØ¨ ÙŠØµÙ†Ø¹ Ø§Ù„Ù…Ø¹Ø¬Ø²Ø§Øª ğŸ”¥";
                els.finalMsg.className = "text-red-500 mb-6 font-bold text-lg";
            }
        }

        function restartGame() {
            startGame();
        }

        function goHome() {
            screens.modal.classList.add('hidden');
            screens.game.classList.add('hidden');
            screens.game.classList.remove('flex');
            screens.home.classList.remove('hidden');
        }

    </script>
</body>
</html>