<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اختبار لغتي التفاعلي - نظام تتابعي</title>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Cairo -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;900&display=swap" rel="stylesheet">
    
    <style>
        body {
            font-family: 'Cairo', sans-serif;
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        .animate-slide-up {
            animation: slideUp 0.5s ease-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- Icon Components (SVG) ---
        const BookOpen = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>
        );
        const CheckCircle = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
        );
        const XCircle = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
        );
        const Award = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>
        );
        const ArrowLeft = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>
        );
        const RefreshCw = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>
        );
        const Star = (props) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" {...props}><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>
        );

        // --- Main Quiz Component ---
        const QuizApp = () => {
            // State
            const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);
            const [selectedOption, setSelectedOption] = useState(null);
            const [isAnswerChecked, setIsAnswerChecked] = useState(false);
            const [score, setScore] = useState(0);
            const [showResults, setShowResults] = useState(false);
            const [quizStarted, setQuizStarted] = useState(false);
            const [history, setHistory] = useState([]); // To track all answers for final review

            // Raw Data
            const rawQuizData = [
                {
                    sectionTitle: "فهم المقروء",
                    passage: "كان لرجل في قديم الزمان ولد، وكان يصحبه إلى الغابة ويدربه على صيد الحيوانات والطيور، حتى صار شاباً قادراً على العمل، فنصحه أبوه بأن يعتمد على نفسه ويخرج للصيد وحده. فرح الشاب وحمل زاده وذهب إلى الغابة، وفي طريقه رأى ثعلباً هرماً جائعاً، فأخذ يفكر في أمر هذا الحيوان وهو يقول في نفسه: كيف يحصل هذا الحيوان على قوته؟ إنه هالك لا محالة. في هذا الوقت أحس الشاب بحركة غريبة، فاختبأ خلف صخرة وإذا بأسد يظهر وهو يجر فريسته، فأكل منها حتى شبع ثم انصرف، فزحف الثعلب ليأكل مما أبقاه الأسد. تعجب الشاب وقال في نفسه: لقد جاء الثعلب رزق بلا كد، فلماذا أبتعد عن أهلي وأتحمل مشاق السفر لأجد رزقي؟! عاد الشاب إلى البيت وشرح لأبيه أسباب عودته. فقال له أبوه: أريدك يا بني أن تكون أسداً تأكل من فضلاتك الثعالب، لا ثعلباً تأكل من فضلات الأسود. فهم الشاب قصد أبيه؛ فخجل من نفسه وعاد من جديد ليعمل ويكد ويحصل على رزقه معتمداً على نفسه.",
                    questions: [
                        { id: 1, question: "بم نصح الأب ابنه؟", options: ["بأن يصطاد الحيوانات والطيور", "بأن يعتمد على نفسه", "يذهب إلى الغابة وحده"], correctAnswer: 1 },
                        { id: 2, question: "لماذا ظن الولد أن الثعلب هالك لا محالة؟", options: ["بسبب كبر سنه (هرمه)", "بسبب هجوم الأسد", "بسبب مرضه الشديد"], correctAnswer: 0 },
                        { id: 3, question: "مم تعجب الشاب؟", options: ["من جر الأسد فريسته", "من قوة الأسد", "من أكل الثعلب بدون كد وتعب"], correctAnswer: 2 },
                        { id: 4, question: "أراد الأب لابنه أن يكون:", options: ["ثعلباً تأكل من فضلاته الأسود", "أسداً تأكل من فضلاته الثعالب", "غير ذلك"], correctAnswer: 1 },
                        { id: 5, question: "العنوان المناسب للقصة هو:", options: ["دعوة للعمل", "دعوة للتفاهم", "دعوة للتكامل"], correctAnswer: 0 },
                        { id: 6, question: "جمع كلمة 'ثعلب':", options: ["ثعالب", "تعاليب", "ثعلبان"], correctAnswer: 0 },
                        { id: 7, question: "معنى 'قوته' في جملة (يحصل الحيوان على قوته):", options: ["شرابه", "طعامه", "حريته"], correctAnswer: 1 },
                        { id: 8, question: "الفكرة الرئيسية للنص:", options: ["الحث على العمل", "الابتعاد عن الحيوانات", "الخوف من الحيوانات"], correctAnswer: 0 },
                        { id: 9, question: "كان الرجل يعلم ابنه الصيد في الغابة.", options: ["صحيح", "خطأ"], correctAnswer: 0 },
                        { id: 10, question: "كان الثعلب يعتمد على نفسه في تحصيل رزقه.", options: ["صحيح", "خطأ"], correctAnswer: 1 }
                    ]
                },
                {
                    sectionTitle: "الوظيفة النحوية",
                    questions: [
                        { id: 11, question: "الاسم المجرور في جملة (ينجح المجتهد في دروسه):", options: ["ينجح", "المجتهد", "دروسه"], correctAnswer: 2 },
                        { id: 12, question: "الجملة الاسمية تتكون من:", options: ["جار ومجرور", "فعل وفاعل", "مبتدأ وخبر"], correctAnswer: 2 },
                        { id: 13, question: "نوع جملة (السماء صافية):", options: ["جملة اسمية", "جملة فعلية", "شبه جملة"], correctAnswer: 0 },
                        { id: 14, question: "في الجملة (الطالب مجتهد)، أين المبتدأ؟", options: ["الطالب", "مجتهد", "لا شيء مما سبق"], correctAnswer: 0 },
                        { id: 15, question: "نوع كلمة 'قلم':", options: ["حرف", "اسم", "فعل"], correctAnswer: 1 },
                        { id: 16, question: "إعراب كلمة 'النصيحة' في جملة (قدم المسلم النصيحة):", options: ["فاعل مرفوع وعلامة رفعه الضمة", "خبر مرفوع وعلامة رفعه الضمة", "مفعول به منصوب وعلامة نصبه الفتحة"], correctAnswer: 2 },
                        { id: 17, question: "أكمل بفاعل مناسب: (.......... يحفظ الأمانة)", options: ["المسلمُ (مرفوع بالضمة)", "المسلمَ (منصوب بالفتحة)", "المسلمِ (مجرور بالكسرة)"], correctAnswer: 0 },
                        { id: 18, question: "أين الخبر في جملة (النباتات غذاء للإنسان)؟", options: ["النباتات", "غذاء", "للإنسان"], correctAnswer: 1 },
                        { id: 19, question: "عند تحويل الفعل الماضي 'قرأ' إلى مضارع نقول:", options: ["قرأت", "يقرأ", "اقرأ"], correctAnswer: 1 },
                        { id: 20, question: "إعراب كلمة 'الأمطار' في جملة (الأمطار غزيرة):", options: ["فاعل مرفوع", "مبتدأ مرفوع وعلامة رفعه الضمة", "خبر مرفوع"], correctAnswer: 1 }
                    ]
                },
                {
                    sectionTitle: "الظاهرة الإملائية",
                    questions: [
                        { id: 21, question: "الكلمة التي بها همزة قطع:", options: ["أكرم", "المعلم", "التلميذ"], correctAnswer: 0 },
                        { id: 22, question: "الكلمة التي بها همزة وصل:", options: ["أحمد", "أقبل", "انطلق"], correctAnswer: 2 },
                        { id: 23, question: "الكلمة التي حذفت الألف من وسطها في جملة (هؤلاء العلماء يخدمون البشرية):", options: ["هؤلاء", "العلماء", "يخدمون"], correctAnswer: 0 },
                        { id: 24, question: "الشمس ساطعة ............... الجو بارد:", options: ["لاكن", "لكن", "لكنا"], correctAnswer: 1 },
                        { id: 25, question: "اليوم الذي يلي يوم الجمعة:", options: ["السبت", "السبة", "السبه"], correctAnswer: 0 },
                        { id: 26, question: "كتبت الهمزة في كلمة 'مفاجئ' على الياء لأن:", options: ["الهمزة مكسورة", "ما قبل الهمزة مكسور", "الهمزة مضمومة"], correctAnswer: 1 },
                        { id: 27, question: "الكلمة الصحيحة المكونة من الحروف (ب - ؤ - ب - ؤ):", options: ["بؤبؤ", "بؤبو", "بأبأ"], correctAnswer: 0 },
                        { id: 28, question: "الكلمة الصحيحة المكونة من الحروف (ش - ا - ط - ئ):", options: ["شاطيء", "شاطئ", "شاطىء"], correctAnswer: 1 }
                    ]
                },
                {
                    sectionTitle: "الأسلوب والخط",
                    questions: [
                        { id: 29, question: "نوع الجملة (الأزهار متفتحة):", options: ["جملة مثبتة", "جملة منفية", "جملة طلبية"], correctAnswer: 0 },
                        { id: 30, question: "إذا كان الحدث لم يتحقق سميت الجملة:", options: ["منفية", "مثبتة", "اسمية"], correctAnswer: 0 },
                        { id: 31, question: "من أدوات النفي:", options: ["على", "لن", "في"], correctAnswer: 1 },
                        { id: 32, question: "نوع جملة (لم يغضب الأسد):", options: ["جملة منفية", "جملة فعلية مثبتة", "جملة اسمية"], correctAnswer: 0 },
                        { id: 33, question: "نوع الأسلوب في (شكراً لك يا أبي، أطال الله في عمرك):", options: ["أسلوب نفي", "أسلوب دعاء", "أسلوب نهي"], correctAnswer: 1 },
                        { id: 34, question: "ما هو الخط الذي ندرسه في المرحلة الابتدائية؟", options: ["الرقعة", "النسخ", "الثلث"], correctAnswer: 1 },
                        { id: 35, question: "من الحروف التي ينزل جزء منها تحت السطر في خط النسخ:", options: ["الباء", "الطاء", "الواو"], correctAnswer: 2 }
                    ]
                }
            ];

            // Flatten data for sequential access
            const allQuestions = useMemo(() => {
                let flattened = [];
                rawQuizData.forEach(section => {
                    section.questions.forEach(q => {
                        flattened.push({
                            ...q,
                            sectionTitle: section.sectionTitle,
                            passage: section.passage || null // Attach passage if exists in section
                        });
                    });
                });
                return flattened;
            }, []);

            const currentQuestion = allQuestions[currentQuestionIndex];
            const totalQuestions = allQuestions.length;

            const handleOptionSelect = (optionIndex) => {
                if (isAnswerChecked) return; // Prevent changing after check

                setSelectedOption(optionIndex);
                setIsAnswerChecked(true);

                const isCorrect = optionIndex === currentQuestion.correctAnswer;
                if (isCorrect) {
                    setScore(prev => prev + 1);
                }

                // Record history
                setHistory(prev => [...prev, {
                    ...currentQuestion,
                    userAnswer: optionIndex,
                    isCorrect: isCorrect
                }]);
            };

            const handleNext = () => {
                if (currentQuestionIndex < totalQuestions - 1) {
                    setCurrentQuestionIndex(prev => prev + 1);
                    setSelectedOption(null);
                    setIsAnswerChecked(false);
                } else {
                    setShowResults(true);
                }
            };

            const handleRestart = () => {
                setCurrentQuestionIndex(0);
                setSelectedOption(null);
                setIsAnswerChecked(false);
                setScore(0);
                setShowResults(false);
                setHistory([]);
                setQuizStarted(false);
            };

            // --- Views ---

            // 1. Start Screen
            if (!quizStarted) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-indigo-50 to-blue-100 flex items-center justify-center p-4 font-cairo" dir="rtl">
                        <div className="bg-white rounded-2xl shadow-2xl p-8 max-w-2xl w-full text-center border-t-8 border-indigo-600 animate-fade-in">
                            <div className="mb-6 flex justify-center">
                                <div className="bg-indigo-100 p-4 rounded-full">
                                    <BookOpen className="w-16 h-16 text-indigo-600" />
                                </div>
                            </div>
                            <h1 className="text-4xl font-bold text-gray-800 mb-4">اختبار لغتي التفاعلي</h1>
                            <p className="text-xl text-gray-600 mb-8 leading-relaxed">
                                اختبار شامل بنظام تفاعلي (سؤال بسؤال).
                                <br/>
                                <span className="font-bold text-indigo-600">{totalQuestions} سؤال</span> في المهارات اللغوية المختلفة.
                            </p>
                            <button 
                                onClick={() => setQuizStarted(true)}
                                className="bg-indigo-600 hover:bg-indigo-700 text-white text-xl font-bold py-4 px-12 rounded-full shadow-lg transform transition hover:scale-105 flex items-center justify-center mx-auto gap-2"
                            >
                                ابدأ الاختبار <ArrowLeft className="w-6 h-6" />
                            </button>
                        </div>
                    </div>
                );
            }

            // 2. Results Screen
            if (showResults) {
                const percentage = Math.round((score / totalQuestions) * 100);
                return (
                    <div className="min-h-screen bg-gray-50 p-4 font-cairo" dir="rtl">
                        <div className="max-w-3xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden animate-slide-up">
                            <div className={`p-8 text-center ${percentage >= 80 ? 'bg-green-600' : percentage >= 50 ? 'bg-yellow-500' : 'bg-red-500'} text-white`}>
                                <Award className="w-20 h-20 mx-auto mb-4" />
                                <h2 className="text-3xl font-bold mb-2">نتيجة الاختبار</h2>
                                <div className="text-6xl font-bold mb-2">{percentage}%</div>
                                <p className="text-xl opacity-90">أجبت بشكل صحيح على {score} من أصل {totalQuestions} سؤال</p>
                            </div>
                            
                            <div className="p-8">
                                <h3 className="text-2xl font-bold text-gray-800 mb-6 border-b pb-2">تفاصيل الإجابات</h3>
                                <div className="space-y-4">
                                    {history.map((item, idx) => (
                                        <div key={idx} className={`p-4 rounded-lg border-r-4 ${item.isCorrect ? 'bg-green-50 border-green-500' : 'bg-red-50 border-red-500'}`}>
                                            <div className="flex justify-between items-start">
                                                <div className="font-bold text-gray-700 mb-1">س{idx + 1}: {item.question}</div>
                                                {item.isCorrect ? <CheckCircle className="text-green-600 w-5 h-5"/> : <XCircle className="text-red-600 w-5 h-5"/>}
                                            </div>
                                            <div className="text-sm mt-2">
                                                <span className={item.isCorrect ? "text-green-700 font-bold" : "text-red-600 line-through"}>
                                                    إجابتك: {item.options[item.userAnswer]}
                                                </span>
                                                {!item.isCorrect && (
                                                    <span className="text-green-700 font-bold block mt-1">
                                                        الإجابة الصحيحة: {item.options[item.correctAnswer]}
                                                    </span>
                                                )}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                                <div className="mt-8 flex justify-center">
                                    <button 
                                        onClick={handleRestart}
                                        className="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 px-8 rounded-lg shadow flex items-center gap-2"
                                    >
                                        <RefreshCw className="w-5 h-5" /> إعادة الاختبار
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            // 3. Question Screen (Sequential)
            return (
                <div className="min-h-screen bg-gray-100 font-cairo pb-12 flex flex-col" dir="rtl">
                    {/* Header */}
                    <header className="bg-white shadow-sm sticky top-0 z-10">
                        <div className="max-w-3xl mx-auto px-4 py-4 flex justify-between items-center">
                            <div className="flex items-center gap-2 text-indigo-600 font-bold text-lg">
                                <BookOpen className="w-6 h-6" />
                                <span className="hidden sm:inline">اختبار لغتي</span>
                            </div>
                            <div className="flex items-center gap-4">
                                <span className="bg-indigo-100 text-indigo-800 px-3 py-1 rounded-full text-sm font-bold">
                                    القسم: {currentQuestion.sectionTitle}
                                </span>
                                <span className="text-gray-600 font-bold">
                                    {currentQuestionIndex + 1} / {totalQuestions}
                                </span>
                            </div>
                        </div>
                        {/* Progress Bar */}
                        <div className="w-full h-2 bg-gray-200">
                            <div 
                                className="h-full bg-indigo-600 transition-all duration-300 ease-out"
                                style={{ width: `${((currentQuestionIndex + 1) / totalQuestions) * 100}%` }}
                            ></div>
                        </div>
                    </header>

                    <main className="flex-1 max-w-3xl w-full mx-auto px-4 py-6 flex flex-col justify-center">
                        
                        {/* Reading Passage Context (Only show if passage exists and it's the first few questions of that section or just sticky?)
                            Better UX: Show passage in an expander or always visible for relevant questions. 
                            Since it's sequential, let's show it if available for the current question.
                         */}
                        {currentQuestion.passage && (
                            <div className="bg-white rounded-xl shadow-md p-5 mb-6 border-r-4 border-yellow-400 text-sm md:text-base leading-relaxed text-gray-700 animate-fade-in">
                                <h4 className="font-bold text-gray-900 mb-2 flex items-center gap-2">
                                    <BookOpen className="w-4 h-4" /> اقرأ النص للإجابة:
                                </h4>
                                {currentQuestion.passage}
                            </div>
                        )}

                        {/* Question Card */}
                        <div className="bg-white rounded-2xl shadow-lg p-6 md:p-8 animate-slide-up relative overflow-hidden">
                            <h2 className="text-xl md:text-2xl font-bold text-gray-800 mb-8 leading-snug">
                                {currentQuestion.question}
                            </h2>

                            <div className="space-y-3">
                                {currentQuestion.options.map((option, index) => {
                                    // Determine styling based on state
                                    let btnClass = "w-full text-right p-4 rounded-xl border-2 font-medium transition-all duration-200 flex justify-between items-center ";
                                    
                                    if (isAnswerChecked) {
                                        if (index === currentQuestion.correctAnswer) {
                                            btnClass += "bg-green-100 border-green-500 text-green-800 shadow-md"; // Correct
                                        } else if (index === selectedOption) {
                                            btnClass += "bg-red-100 border-red-500 text-red-800"; // Wrong selected
                                        } else {
                                            btnClass += "bg-gray-50 border-gray-100 text-gray-400 opacity-60"; // Others
                                        }
                                    } else {
                                        // Default state
                                        btnClass += "bg-white border-gray-200 hover:border-indigo-400 hover:bg-indigo-50 text-gray-700";
                                    }

                                    return (
                                        <button
                                            key={index}
                                            onClick={() => handleOptionSelect(index)}
                                            disabled={isAnswerChecked}
                                            className={btnClass}
                                        >
                                            <span>{option}</span>
                                            {isAnswerChecked && index === currentQuestion.correctAnswer && <CheckCircle className="w-6 h-6 text-green-600" />}
                                            {isAnswerChecked && index === selectedOption && index !== currentQuestion.correctAnswer && <XCircle className="w-6 h-6 text-red-600" />}
                                        </button>
                                    );
                                })}
                            </div>

                            {/* Feedback & Next Button Area */}
                            {isAnswerChecked && (
                                <div className="mt-8 pt-6 border-t animate-fade-in">
                                    <div className={`mb-4 font-bold text-lg ${selectedOption === currentQuestion.correctAnswer ? 'text-green-600' : 'text-red-600'}`}>
                                        {selectedOption === currentQuestion.correctAnswer ? (
                                            <div className="flex items-center gap-2"><CheckCircle className="w-6 h-6"/> إجابة صحيحة! أحسنت.</div>
                                        ) : (
                                            <div className="flex items-center gap-2"><XCircle className="w-6 h-6"/> إجابة خاطئة. الصحيح هو: {currentQuestion.options[currentQuestion.correctAnswer]}</div>
                                        )}
                                    </div>
                                    
                                    <button
                                        onClick={handleNext}
                                        className="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-xl shadow-lg transform transition hover:scale-[1.02] flex items-center justify-center gap-2"
                                    >
                                        {currentQuestionIndex === totalQuestions - 1 ? "عرض النتيجة النهائية" : "السؤال التالي"} 
                                        <ArrowLeft className="w-5 h-5" />
                                    </button>
                                </div>
                            )}
                        </div>
                    </main>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<QuizApp />);
    </script>
</body>
</html>

