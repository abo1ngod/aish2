<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            direction: rtl;
            padding: 15px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }

        .header h1 {
            color: #667eea;
            font-size: clamp(1.5em, 5vw, 2.5em);
            margin-bottom: 10px;
        }

        .round-status {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #e5e7eb;
        }

        .round-info {
            font-size: 1.2em;
            color: #4b5563;
        }

        .round-name {
            font-weight: bold;
            color: #764ba2;
            font-size: 1.5em;
        }

        .status-badge {
            padding: 10px 25px;
            border-radius: 25px;
            font-weight: bold;
            font-size: 1.1em;
        }

        .status-active {
            background: #d1fae5;
            color: #065f46;
        }

        .status-inactive {
            background: #fee2e2;
            color: #991b1b;
        }

        /* Grid Layout */
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        @media (min-width: 1024px) {
            .dashboard-grid {
                grid-template-columns: 2fr 1fr;
                gap: 30px;
                margin-bottom: 30px;
            }
        }

        /* Card Styles */
        .card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card-title {
            font-size: clamp(1.3em, 4vw, 1.8em);
            color: #1f2937;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #667eea;
            font-weight: bold;
        }

        /* Question Form */
        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #374151;
            font-size: 1.1em;
        }

        input[type="text"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #d1d5db;
            border-radius: 8px;
            font-size: 1em;
            font-family: inherit;
            transition: border-color 0.3s;
        }

        input[type="text"]:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
        }

        @media (min-width: 768px) {
            .options-grid {
                grid-template-columns: 1fr 1fr;
            }
        }

        /* Buttons */
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-warning:hover {
            background: #d97706;
        }

        .btn-block {
            width: 100%;
            margin-bottom: 10px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Teams Table */
        .table-container {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .teams-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            min-width: 600px;
        }

        .teams-table th,
        .teams-table td {
            padding: 12px;
            text-align: center;
            border-bottom: 2px solid #e5e7eb;
            font-size: 0.95em;
        }

        @media (max-width: 768px) {
            .teams-table th,
            .teams-table td {
                padding: 8px;
                font-size: 0.85em;
            }
        }

        /* Players List */
        .players-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: #f9fafb;
            border-radius: 8px;
            margin-bottom: 10px;
        }

        .player-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .player-name {
            font-weight: bold;
            color: #1f2937;
        }

        .player-team {
            color: #6b7280;
            font-size: 0.9em;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
        }

        .status-online {
            background: #10b981;
            box-shadow: 0 0 10px #10b981;
        }

        .status-offline {
            background: #6b7280;
        }

        /* Control Buttons Section */
        .controls-section {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        @media (min-width: 768px) {
            .controls-section {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
        }

        /* Alerts */
        .alert {
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: bold;
            display: none;
        }

        .alert.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #10b981;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 2px solid #ef4444;
        }

        /* Navigation Buttons */
        .nav-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .nav-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            font-size: 0.9em;
            flex: 1 1 auto;
            min-width: 120px;
        }

        .nav-btn:hover {
            background: #764ba2;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø©</h1>
            <div class="nav-buttons">
                <button class="nav-btn" onclick="window.location.href='contestants.html'">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ†</button>
                <button class="nav-btn" onclick="window.location.href='questions-bank.html'">Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</button>
            </div>
            <div class="round-status">
                <div class="round-info">
                    <span>Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: </span>
                    <span class="round-name" id="roundName">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬ÙˆÙ„Ø© Ù†Ø´Ø·Ø©</span>
                </div>
                <div>
                    <span class="status-badge status-inactive" id="statusBadge">ØºÙŠØ± Ù†Ø´Ø·</span>
                </div>
            </div>
        </div>

        <!-- Alerts -->
        <div id="alertSuccess" class="alert alert-success"></div>
        <div id="alertError" class="alert alert-error"></div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Question Publishing Form -->
            <div class="card">
                <h2 class="card-title">Ù†Ø´Ø± Ø³Ø¤Ø§Ù„ Ø¬Ø¯ÙŠØ¯</h2>
                
                <form id="questionForm">
                    <div class="form-group">
                        <label>Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„</label>
                        <textarea id="questionText" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù‡Ù†Ø§..." required></textarea>
                    </div>

                    <div class="options-grid">
                        <div class="form-group">
                            <label>Ø§Ù„Ø®ÙŠØ§Ø± Ø£</label>
                            <input type="text" id="optionA" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„" required>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ø®ÙŠØ§Ø± Ø¨</label>
                            <input type="text" id="optionB" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù†ÙŠ" required>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ø®ÙŠØ§Ø± Ø¬</label>
                            <input type="text" id="optionC" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø«Ø§Ù„Ø«" required>
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ø®ÙŠØ§Ø± Ø¯</label>
                            <input type="text" id="optionD" placeholder="Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø±Ø§Ø¨Ø¹" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</label>
                        <select id="correctAnswer" required>
                            <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©</option>
                            <option value="A">Ø£</option>
                            <option value="B">Ø¨</option>
                            <option value="C">Ø¬</option>
                            <option value="D">Ø¯</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">Ù†Ø´Ø± Ø§Ù„Ø³Ø¤Ø§Ù„</button>
                </form>

                <div class="controls-section">
                    <button class="btn btn-warning" id="lockQuestionBtn" disabled>Ù‚ÙÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„</button>
                    <button class="btn btn-success" id="unlockQuestionBtn" disabled>ÙØªØ­ Ø§Ù„Ø³Ø¤Ø§Ù„</button>
                </div>
            </div>

            <!-- Round Controls -->
            <div class="card">
                <h2 class="card-title">Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø¬ÙˆÙ„Ø©</h2>
                
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ø¬ÙˆÙ„Ø©</label>
                    <input type="text" id="newRoundName" placeholder="Ø§Ù„Ø¬ÙˆÙ„Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰">
                </div>

                <button class="btn btn-success btn-block" id="startRoundBtn">Ø¨Ø¯Ø¡ Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
                <button class="btn btn-danger btn-block" id="stopRoundBtn" disabled>Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¬ÙˆÙ„Ø©</button>
                <button class="btn btn-primary btn-block" id="endRoundBtn" disabled>Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
            </div>
        </div>

        <!-- Teams Scoreboard -->
        <div class="card">
            <h2 class="card-title">Ù„ÙˆØ­Ø© Ù†Ù‚Ø§Ø· Ø§Ù„ÙØ±Ù‚</h2>
            <div class="table-container">
                <table class="teams-table" id="teamsTable">
                    <thead>
                        <tr>
                            <th>Ø§Ù„ØªØ±ØªÙŠØ¨</th>
                            <th>Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚</th>
                            <th>Ø§Ù„Ù†Ù‚Ø§Ø·</th>
                            <th>Ø¹Ø¯Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†</th>
                        </tr>
                    </thead>
                    <tbody id="teamsTableBody">
                        <tr>
                            <td colspan="4">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Online Players -->
        <div class="card">
            <h2 class="card-title">Ø§Ù„Ù„Ø§Ø¹Ø¨ÙˆÙ† Ø§Ù„Ù…ØªØµÙ„ÙˆÙ†</h2>
            <div class="players-list" id="playersList">
                <div style="text-align: center; color: #6b7280; padding: 20px;">
                    Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙˆÙ† Ù…ØªØµÙ„ÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹
                </div>
            </div>
        </div>
    </div>

    <!-- Ø¥Ø¶Ø§ÙØ© Firebase SDK ÙˆØ§Ù„ØªÙƒÙˆÙŠÙ† -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script>
        // ============================================
        // FIREBASE CONFIGURATION
        // ============================================
        const firebaseConfig = {
            apiKey: "AIzaSyBxPO6RKsQ1Cq-mqlCpFTrCuIyxnYdB37U",
            authDomain: "studentsystem-c1ab1.firebaseapp.com",
            databaseURL: "https://studentsystem-c1ab1-default-rtdb.firebaseio.com",
            projectId: "studentsystem-c1ab1",
            storageBucket: "studentsystem-c1ab1.firebasestorage.app",
            messagingSenderId: "112215023848",
            appId: "1:112215023848:web:0adba326a527ee7e37e95d"
        };
        
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        
        const db = firebase.database();
        const rootRef = db.ref('vo_001');

        // ============================================
        // GLOBAL STATE
        // ============================================
        let currentRoundId = null;
        let currentQuestionId = null;
        let teamsData = {};
        let playersData = {};

        // ============================================
        // FIREBASE LISTENERS
        // ============================================
        function initializeFirebaseListeners() {
            // Listen to active round
            rootRef.child('rounds/active').on('value', (snapshot) => {
                const activeRoundId = snapshot.val();
                if (activeRoundId) {
                    currentRoundId = activeRoundId;
                    loadRoundData(activeRoundId);
                    document.getElementById('stopRoundBtn').disabled = false;
                    document.getElementById('endRoundBtn').disabled = false;
                    document.getElementById('startRoundBtn').disabled = true;
                } else {
                    currentRoundId = null;
                    document.getElementById('roundName').textContent = 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬ÙˆÙ„Ø© Ù†Ø´Ø·Ø©';
                    document.getElementById('statusBadge').textContent = 'ØºÙŠØ± Ù†Ø´Ø·';
                    document.getElementById('statusBadge').className = 'status-badge status-inactive';
                    document.getElementById('stopRoundBtn').disabled = true;
                    document.getElementById('endRoundBtn').disabled = true;
                    document.getElementById('startRoundBtn').disabled = false;
                }
            });
        }

        function loadRoundData(roundId) {
            // Listen to round info
            rootRef.child(`rounds/${roundId}`).on('value', (snapshot) => {
                const roundData = snapshot.val();
                if (roundData) {
                    document.getElementById('roundName').textContent = roundData.name || roundId;
                    document.getElementById('statusBadge').textContent = 'Ù†Ø´Ø·';
                    document.getElementById('statusBadge').className = 'status-badge status-active';
                    
                    // Load teams
                    if (roundData.teams) {
                        teamsData = roundData.teams;
                        updateTeamsTable();
                    }
                    
                    // Load players
                    if (roundData.players) {
                        playersData = roundData.players;
                        updatePlayersList();
                    }
                    
                    // Load current question
                    if (roundData.currentQuestion) {
                        currentQuestionId = roundData.currentQuestion.id;
                        updateQuestionControls(roundData.currentQuestion.status);
                    }
                }
            });
        }

        function updateQuestionControls(status) {
            const lockBtn = document.getElementById('lockQuestionBtn');
            const unlockBtn = document.getElementById('unlockQuestionBtn');
            
            if (status === 'open') {
                lockBtn.disabled = false;
                unlockBtn.disabled = true;
            } else if (status === 'locked') {
                lockBtn.disabled = true;
                unlockBtn.disabled = false;
            } else {
                lockBtn.disabled = true;
                unlockBtn.disabled = true;
            }
        }

        // ============================================
        // ROUND MANAGEMENT
        // ============================================
        document.getElementById('startRoundBtn').addEventListener('click', async () => {
            const roundName = document.getElementById('newRoundName').value.trim() || 'Ø¬ÙˆÙ„Ø© Ø¬Ø¯ÙŠØ¯Ø©';
            const newRoundId = 'round_' + Date.now();
            
            try {
                await rootRef.child(`rounds/${newRoundId}`).set({
                    name: roundName,
                    status: 'active',
                    createdAt: firebase.database.ServerValue.TIMESTAMP,
                    teams: {
                        team1: { name: 'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø²Ø±Ù‚', score: 0, color: '#3b82f6' },
                        team2: { name: 'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø­Ù…Ø±', score: 0, color: '#ef4444' },
                        team3: { name: 'Ø§Ù„ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø®Ø¶Ø±', score: 0, color: '#10b981' }
                    },
                    players: {}
                });
                
                await rootRef.child('rounds/active').set(newRoundId);
                showAlert('success', 'ØªÙ… Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© Ø¨Ù†Ø¬Ø§Ø­!');
            } catch (error) {
                showAlert('error', 'Ø®Ø·Ø£ ÙÙŠ Ø¨Ø¯Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø©: ' + error.message);
            }
        });

        document.getElementById('stopRoundBtn').addEventListener('click', async () => {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¬ÙˆÙ„Ø©ØŸ')) {
                try {
                    await rootRef.child('rounds/active').remove();
                    showAlert('success', 'ØªÙ… Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¬ÙˆÙ„Ø©');
                } catch (error) {
                    showAlert('error', 'Ø®Ø·Ø£ ÙÙŠ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ø¬ÙˆÙ„Ø©: ' + error.message);
                }
            }
        });

        document.getElementById('endRoundBtn').addEventListener('click', async () => {
            if (!currentRoundId) return;
            
            try {
                await rootRef.child(`rounds/${currentRoundId}`).update({
                    status: 'finished',
                    finishedAt: firebase.database.ServerValue.TIMESTAMP
                });
                
                await rootRef.child('rounds/active').remove();
                showAlert('success', 'ØªÙ… Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø© ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©');
            } catch (error) {
                showAlert('error', 'Ø®Ø·Ø£ ÙÙŠ Ø¥Ù†Ù‡Ø§Ø¡ Ø§Ù„Ø¬ÙˆÙ„Ø©: ' + error.message);
            }
        });

        // ============================================
        // QUESTION MANAGEMENT
        // ============================================
        document.getElementById('questionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            if (!currentRoundId) {
                showAlert('error', 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¬ÙˆÙ„Ø© Ù†Ø´Ø·Ø©!');
                return;
            }
            
            const questionData = {
                id: 'q_' + Date.now(),
                text: document.getElementById('questionText').value.trim(),
                options: {
                    A: document.getElementById('optionA').value.trim(),
                    B: document.getElementById('optionB').value.trim(),
                    C: document.getElementById('optionC').value.trim(),
                    D: document.getElementById('optionD').value.trim()
                },
                correctAnswer: document.getElementById('correctAnswer').value,
                status: 'open',
                publishedAt: firebase.database.ServerValue.TIMESTAMP
            };
            
            try {
                await rootRef.child(`rounds/${currentRoundId}/currentQuestion`).set(questionData);
                await rootRef.child(`rounds/${currentRoundId}/questions/${questionData.id}`).set(questionData);
                
                showAlert('success', 'ØªÙ… Ù†Ø´Ø± Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­!');
                document.getElementById('questionForm').reset();
            } catch (error) {
                showAlert('error', 'Ø®Ø·Ø£ ÙÙŠ Ù†Ø´Ø± Ø§Ù„Ø³Ø¤Ø§Ù„: ' + error.message);
            }
        });

        document.getElementById('lockQuestionBtn').addEventListener('click', async () => {
            if (!currentRoundId || !currentQuestionId) return;
            
            try {
                await rootRef.child(`rounds/${currentRoundId}/currentQuestion/status`).set('locked');
                showAlert('success', 'ØªÙ… Ù‚ÙÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„');
            } catch (error) {
                showAlert('error', 'Ø®Ø·Ø£ ÙÙŠ Ù‚ÙÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„: ' + error.message);
            }
        });

        document.getElementById('unlockQuestionBtn').addEventListener('click', async () => {
            if (!currentRoundId || !currentQuestionId) return;
            
            try {
                await rootRef.child(`rounds/${currentRoundId}/currentQuestion/status`).set('open');
                showAlert('success', 'ØªÙ… ÙØªØ­ Ø§Ù„Ø³Ø¤Ø§Ù„');
            } catch (error) {
                showAlert('error', 'Ø®Ø·Ø£ ÙÙŠ ÙØªØ­ Ø§Ù„Ø³Ø¤Ø§Ù„: ' + error.message);
            }
        });

        // ============================================
        // UI UPDATES
        // ============================================
        function updateTeamsTable() {
            const tbody = document.getElementById('teamsTableBody');
            tbody.innerHTML = '';
            
            const sortedTeams = Object.entries(teamsData).sort((a, b) => b[1].score - a[1].score);
            
            sortedTeams.forEach(([teamId, team], index) => {
                const rank = index + 1;
                const medal = rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : rank === 3 ? 'ğŸ¥‰' : rank;
                
                const playerCount = Object.values(playersData).filter(p => p.teamId === teamId).length;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${medal}</td>
                    <td>${team.name}</td>
                    <td><span class="score-value">${team.score}</span></td>
                    <td>${playerCount}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updatePlayersList() {
            const container = document.getElementById('playersList');
            container.innerHTML = '';
            
            const playersList = Object.entries(playersData);
            
            if (playersList.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #6b7280; padding: 20px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù„Ø§Ø¹Ø¨ÙˆÙ† Ù…ØªØµÙ„ÙˆÙ† Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
                return;
            }
            
            playersList.forEach(([playerId, player]) => {
                const team = teamsData[player.teamId];
                const isOnline = player.online || false;
                
                const playerEl = document.createElement('div');
                playerEl.className = 'player-item';
                playerEl.innerHTML = `
                    <div class="player-info">
                        <span class="status-indicator ${isOnline ? 'status-online' : 'status-offline'}"></span>
                        <div>
                            <div class="player-name">${player.name}</div>
                            <div class="player-team">${team ? team.name : 'Ø¨Ø¯ÙˆÙ† ÙØ±ÙŠÙ‚'}</div>
                        </div>
                    </div>
                    <div class="score-value">${player.score || 0}</div>
                `;
                container.appendChild(playerEl);
            });
        }

        function showAlert(type, message) {
            const alertEl = document.getElementById(type === 'success' ? 'alertSuccess' : 'alertError');
            alertEl.textContent = message;
            alertEl.classList.add('show');
            
            setTimeout(() => {
                alertEl.classList.remove('show');
            }, 5000);
        }

        // ============================================
        // INITIALIZATION
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸš€ Admin Panel Initialized');
            initializeFirebaseListeners();
        });
    </script>
</body>
</html>
