<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø§Øª Ø§Ù„Ø³Ø±ÙŠØ¹</title>
    
    <!-- Tailwind CSS for Styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700;900&display=swap');
        
        body {
            font-family: 'Tajawal', sans-serif;
            background-color: #f3f4f6;
            touch-action: manipulation;
        }

        .btn-option {
            transition: all 0.1s;
        }
        .btn-option:active {
            transform: scale(0.95);
        }
        
        @keyframes popIn {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop {
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* ØªØ­Ø³ÙŠÙ† Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† */
        .scrolling-wrapper {
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }
        .scrolling-wrapper::-webkit-scrollbar {
            display: none;
        }

        /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø®Ø§ØµØ© Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± */
        .glass-panel {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen text-gray-800 select-none overflow-hidden">

    <!-- Ø­Ø§ÙˆÙŠØ© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
    <div id="app" class="max-w-md mx-auto h-screen bg-white shadow-xl relative overflow-y-auto">
        
        <!-- 1. Ø´Ø§Ø´Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¯ÙˆØ± (Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©) -->
        <div id="screen-login" class="flex flex-col h-full justify-center items-center p-6 space-y-6">
            <h1 class="text-4xl font-black text-blue-600 mb-4">Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© ğŸ”¥</h1>
            
            <div id="login-loading" class="hidden text-gray-500">Ø¬Ø§Ø±Ù Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¬Ù„Ø³Ø©...</div>

            <div id="login-form" class="w-full space-y-3">
                <input type="text" id="player-name-input" placeholder="Ø§Ø³Ù…Ùƒ Ø£Ùˆ Ø§Ø³Ù… Ø§Ù„ÙØ±ÙŠÙ‚" class="w-full p-4 border-2 border-gray-300 rounded-xl text-xl text-center focus:border-blue-500 outline-none">
                
                <input type="number" id="player-code-input" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ" class="w-full p-4 border-2 border-gray-300 rounded-xl text-xl text-center focus:border-blue-500 outline-none">

                <button onclick="joinGame('player')" class="w-full bg-blue-600 text-white p-4 rounded-xl text-xl font-bold shadow-lg hover:bg-blue-700 active:bg-blue-800 transition">
                    Ø¯Ø®ÙˆÙ„ ÙƒÙ…ØªØ³Ø§Ø¨Ù‚ ğŸƒâ€â™‚ï¸
                </button>
            </div>

            <div class="flex space-x-2 space-x-reverse w-full pt-8 border-t">
                <button onclick="joinGame('admin')" class="flex-1 bg-gray-800 text-white p-2 rounded-lg text-sm">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù ğŸ› </button>
                <button onclick="joinGame('audience')" class="flex-1 bg-green-600 text-white p-2 rounded-lg text-sm">Ø´Ø§Ø´Ø© Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± ğŸ“º</button>
            </div>
        </div>

        <!-- 2. Ø´Ø§Ø´Ø© Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ -->
        <div id="screen-player" class="hidden flex flex-col h-full relative">
            <!-- Ø±Ø£Ø³ Ø§Ù„ØµÙØ­Ø©: Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ§Ù„Ø§Ø³Ù… -->
            <div class="bg-blue-600 text-white p-4 flex justify-between items-center shadow-md z-20 relative">
                <div class="flex items-center gap-2">
                    <button onclick="logoutPlayer()" class="bg-red-500 text-white px-2 py-1 rounded text-xs hover:bg-red-600">Ø®Ø±ÙˆØ¬</button>
                    <div>
                        <span class="text-xs opacity-75 block">Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚</span>
                        <h2 id="p-name-display" class="text-xl font-bold truncate max-w-[100px]">...</h2>
                    </div>
                </div>
                <div class="text-center bg-blue-800 px-4 py-2 rounded-lg">
                    <span class="text-xs opacity-75 block">Ø§Ù„Ù†Ù‚Ø§Ø·</span>
                    <span id="p-score-display" class="text-2xl font-black text-yellow-300">0</span>
                </div>
            </div>

            <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† Ø§Ù„Ù…ØµØºØ± -->
            <div class="bg-blue-700 text-white text-xs p-2 shadow-inner z-10">
                <div class="flex items-center gap-2 mb-1 opacity-75">
                    <span>ğŸ‘¥ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙˆÙ†:</span>
                </div>
                <div id="player-mini-leaderboard" class="scrolling-wrapper flex space-x-4 space-x-reverse pb-1">
                    <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ Ø¨Ø§Ù„ÙƒÙˆØ¯ -->
                </div>
            </div>

            <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ -->
            <div class="flex-1 p-4 flex flex-col justify-center pb-24 overflow-y-auto">
                <div id="waiting-msg" class="text-center text-gray-500 animate-pulse">
                    <p class="text-2xl font-bold mb-2">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø³Ø¤Ø§Ù„...</p>
                    <p class="text-sm">Ø§Ø³ØªØ¹Ø¯ ÙˆØ¶Ø¹ Ø¥ØµØ¨Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø©!</p>
                </div>

                <div id="active-question-area" class="hidden space-y-4">
                    <div class="bg-blue-50 p-4 rounded-2xl border-2 border-blue-100 mb-4">
                        <p id="q-text" class="text-xl font-bold text-center leading-relaxed">...</p>
                    </div>

                    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„ØªØºØ°ÙŠØ© Ø§Ù„Ø±Ø§Ø¬Ø¹Ø© -->
                    <div id="feedback-area" class="hidden rounded-lg text-center text-sm mb-2 animate-pop border shadow-md">
                    </div>

                    <!-- Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª -->
                    <div id="options-container" class="space-y-3">
                        <!-- ØªØ¶Ø§Ù Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù‡Ù†Ø§ Ø¨Ø§Ù„ÙƒÙˆØ¯ -->
                    </div>
                </div>
            </div>

            <!-- Ø´Ø±ÙŠØ· Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙÙ„ÙŠ -->
            <div id="status-bar" class="absolute bottom-0 w-full p-3 text-center text-white text-sm font-bold transition-colors duration-300 bg-gray-500 z-20">
                Ø¬Ø§Ù‡Ø² Ù„Ù„Ø§ØªØµØ§Ù„...
            </div>
        </div>

        <!-- 3. Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø´Ø±Ù -->
        <div id="screen-admin" class="hidden flex flex-col h-full p-4 bg-gray-900 text-white overflow-y-auto">
            <h2 class="text-2xl font-bold text-yellow-400 mb-4 text-center">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
            
            <div class="bg-gray-800 p-4 rounded-xl mb-4 border border-gray-700">
                <h3 class="font-bold mb-2 text-blue-300">1. Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ†</h3>
                <div class="flex gap-2 mb-2">
                    <input id="admin-players-count" type="number" placeholder="Ø§Ù„Ø¹Ø¯Ø¯" class="w-20 text-black p-2 rounded text-center">
                    <button onclick="adminAddCodes()" class="bg-green-600 px-3 rounded font-bold hover:bg-green-500 text-sm">Ø¥Ø¶Ø§ÙØ©</button>
                    <button onclick="adminGenerateCodes()" class="flex-1 bg-red-600 px-3 rounded font-bold hover:bg-red-500 text-sm">Ù…Ø³Ø­ ÙˆØªÙˆÙ„ÙŠØ¯ Ø¬Ø¯ÙŠØ¯</button>
                </div>
                <div id="admin-codes-display" class="mt-3 grid grid-cols-3 gap-2 text-center text-sm font-mono">
                </div>
                <ul id="admin-players-list" class="mt-4 space-y-2 text-sm border-t border-gray-700 pt-2">
                </ul>
            </div>

            <div class="bg-gray-800 p-4 rounded-xl mb-4 border border-gray-700">
                <h3 class="font-bold mb-2 text-blue-300">2. Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</h3>
                <textarea id="admin-q-text" class="w-full text-black p-2 rounded mb-2 text-sm" placeholder="Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„"></textarea>
                <input id="admin-q-options" class="w-full text-black p-2 rounded mb-2 text-sm" placeholder="Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª (Ø£ØŒ Ø¨ØŒ Ø¬)">
                <input id="admin-q-correct" type="number" class="w-full text-black p-2 rounded mb-2 text-sm" placeholder="Ø±Ù‚Ù… Ø§Ù„ØµØ­ÙŠØ­ (0 Ù„Ù„Ø£ÙˆÙ„)">
                
                <div class="flex gap-2 mb-4">
                    <button id="btn-add-bank" onclick="adminAddToBank()" class="flex-1 bg-purple-600 p-2 rounded font-bold hover:bg-purple-500 transition-colors">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø¨Ù†Ùƒ</button>
                    <button id="btn-cancel-edit" onclick="resetAdminForm()" class="hidden bg-gray-600 p-2 rounded font-bold hover:bg-gray-500 text-sm">Ø¥Ù„ØºØ§Ø¡</button>
                </div>

                <div class="flex justify-end mb-2">
                     <button onclick="adminResetBankStatus()" class="bg-yellow-600 text-white px-3 py-1 rounded text-xs hover:bg-yellow-500">Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©</button>
                </div>

                <div id="admin-bank-list" class="space-y-2 max-h-60 overflow-y-auto">
                </div>
            </div>

            <div class="bg-red-900 p-4 rounded-xl mb-4">
                 <button onclick="adminResetRound()" class="w-full bg-red-600 p-3 rounded font-bold hover:bg-red-500">Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø­Ø§Ù„ÙŠ / Ø¥Ø¹Ø§Ø¯Ø©</button>
            </div>
        </div>

        <!-- 4. Ø´Ø§Ø´Ø© Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± (Ù…Ø¹Ø§Ø¯ ØªØµÙ…ÙŠÙ…Ù‡Ø§) -->
        <div id="screen-audience" class="hidden flex-col h-full bg-gradient-to-br from-indigo-900 via-purple-900 to-blue-900 text-white p-4 overflow-hidden">
            
            <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
            <header class="text-center mb-4">
                <h1 class="text-3xl font-black text-yellow-400 drop-shadow-lg">ğŸ† Ø§Ù„Ù…Ø³Ø§Ø¨Ù‚Ø© Ø§Ù„ÙƒØ¨Ø±Ù‰</h1>
            </header>

            <!-- Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: Ø´Ø¨ÙƒØ© Ù…Ù† 3 Ø£Ø¹Ù…Ø¯Ø© -->
            <div class="flex-1 grid grid-cols-12 gap-4 h-full pb-4">
                
                <!-- ÙŠÙ…ÙŠÙ†: Ø³Ø¬Ù„ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª (ØªØ§Ø±ÙŠØ®) -->
                <div class="col-span-3 glass-panel rounded-2xl p-4 flex flex-col h-full overflow-hidden">
                    <h3 class="font-bold text-blue-300 mb-3 border-b border-gray-600 pb-2 text-center">â³ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©</h3>
                    <div id="audience-history-list" class="space-y-2 overflow-y-auto flex-1 text-sm">
                        <!-- ÙŠÙ…ØªÙ„Ø¦ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                    </div>
                </div>

                <!-- ÙˆØ³Ø·: Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ ÙˆØ§Ù„Ø­Ø¯Ø« -->
                <div class="col-span-6 flex flex-col justify-center items-center relative">
                    <!-- Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± -->
                    <div id="audience-waiting" class="text-center animate-pulse">
                        <div class="text-6xl mb-4">â³</div>
                        <h2 class="text-2xl font-bold">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„ØªØ§Ù„ÙŠ...</h2>
                    </div>

                    <!-- Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ù†Ø´Ø· -->
                    <div id="audience-q-area" class="hidden w-full space-y-6 animate-pop z-10">
                        <div class="bg-white text-indigo-900 p-6 rounded-3xl shadow-2xl text-center border-4 border-yellow-400">
                            <p id="audience-q-text" class="text-3xl font-bold leading-relaxed">...</p>
                        </div>
                        <div id="audience-options" class="grid grid-cols-2 gap-4 text-xl font-bold">
                            <!-- Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª -->
                        </div>
                    </div>

                    <!-- Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø© (Overlay) -->
                    <div id="audience-result-overlay" class="hidden absolute inset-0 flex items-center justify-center bg-black/60 rounded-3xl z-50 animate-pop backdrop-blur-sm">
                        <div id="audience-result-box" class="bg-white text-black p-8 rounded-2xl shadow-2xl text-center border-4 border-green-500 transform scale-110">
                            <!-- Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù†ØªÙŠØ¬Ø© -->
                        </div>
                    </div>
                </div>

                <!-- ÙŠØ³Ø§Ø±: Ø§Ù„ØªØ±ØªÙŠØ¨ Ø§Ù„Ø¹Ø§Ù… -->
                <div class="col-span-3 glass-panel rounded-2xl p-4 flex flex-col h-full overflow-hidden">
                    <h3 class="font-bold text-yellow-300 mb-3 border-b border-gray-600 pb-2 text-center">ğŸ“Š ØªØ±ØªÙŠØ¨ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ†</h3>
                    <div id="audience-leaderboard" class="space-y-2 overflow-y-auto flex-1 pr-1">
                        <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© -->
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase ---
        const firebaseConfig = {
            apiKey: "AIzaSyBxPO6RKsQ1Cq-mqlCpFTrCuIyxnYdB37U",
            authDomain: "studentsystem-c1ab1.firebaseapp.com",
            databaseURL: "https://studentsystem-c1ab1-default-rtdb.firebaseio.com",
            projectId: "studentsystem-c1ab1",
            storageBucket: "studentsystem-c1ab1.firebasestorage.app",
            messagingSenderId: "112215023848",
            appId: "1:112215023848:web:0adba326a527ee7e37e95d"
        };
        
        if (!firebase.apps.length) {
            firebase.initializeApp(firebaseConfig);
        }
        const db = firebase.database();
        const rootRef = db.ref('osh_001');

        // --- 2. Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© ---
        let myRole = '';
        let myId = null; 
        let myName = ''; 
        let currentQuestionData = null;
        let isButtonsLocked = false;
        let editingQuestionKey = null; // Ù„Ù„Ù…Ø´Ø±Ù

        // --- ÙƒÙˆØ¯ Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (Persistence) ---
        window.onload = function() {
            const savedId = localStorage.getItem('quiz_player_id');
            if(savedId) {
                document.getElementById('login-form').classList.add('hidden');
                document.getElementById('login-loading').classList.remove('hidden');
                
                rootRef.child('players/' + savedId).once('value').then(snap => {
                    if(snap.exists()) {
                        myId = savedId;
                        myName = snap.val().name;
                        joinGame('player', true); 
                    } else {
                        localStorage.removeItem('quiz_player_id');
                        document.getElementById('login-form').classList.remove('hidden');
                        document.getElementById('login-loading').classList.add('hidden');
                    }
                });
            }
        };

        // --- 3. Ø§Ù„ØªÙ†Ù‚Ù„ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø£Ø¯ÙˆØ§Ø± ---
        function joinGame(role, isAuto = false) {
            myRole = role;
            
            if (role === 'player') {
                if (!isAuto) {
                    const nameInput = document.getElementById('player-name-input').value;
                    const codeInput = document.getElementById('player-code-input').value;

                    if(!nameInput || !codeInput) { alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø§Ø³Ù… ÙˆØ§Ù„ÙƒÙˆØ¯'); return; }

                    rootRef.child('access_codes/' + codeInput).once('value').then(snapshot => {
                        if (snapshot.exists() && snapshot.val().status === 'waiting') {
                            myId = 'player_' + codeInput;
                            myName = nameInput;
                            localStorage.setItem('quiz_player_id', myId);
                            
                            rootRef.child('access_codes/' + codeInput).update({ status: 'taken', taken_by: nameInput });
                            startPlayerView();
                        } else {
                            alert('Ø§Ù„ÙƒÙˆØ¯ Ø®Ø§Ø·Ø¦ Ø£Ùˆ Ù…Ø³ØªØ®Ø¯Ù… Ù…Ø³Ø¨Ù‚Ø§Ù‹!');
                        }
                    });
                } else {
                    startPlayerView();
                }

            } else {
                document.getElementById('screen-login').classList.add('hidden');
                if (role === 'admin') {
                    document.getElementById('screen-admin').classList.remove('hidden');
                    initAdmin();
                } else if (role === 'audience') {
                    // Ø¥Ø²Ø§Ù„Ø© ÙØ¦Ø© max-w-md Ù„ØªØ£Ø®Ø° Ø§Ù„Ø´Ø§Ø´Ø© ÙƒØ§Ù…Ù„Ø© Ù„Ù„Ø¬Ù…Ù‡ÙˆØ±
                    document.getElementById('app').classList.remove('max-w-md');
                    document.getElementById('app').classList.add('w-full');
                    document.getElementById('screen-audience').classList.remove('hidden');
                    document.getElementById('screen-audience').classList.add('flex'); // Ø§Ø³ØªØ®Ø¯Ø§Ù… Flex Ù„Ù„ØªØ®Ø·ÙŠØ· Ø§Ù„Ø¬Ø¯ÙŠØ¯
                    initAudience();
                }
            }
        }

        function startPlayerView() {
            document.getElementById('screen-login').classList.add('hidden');
            document.getElementById('screen-player').classList.remove('hidden');
            document.getElementById('p-name-display').innerText = myName;
            initPlayer(myName, myId);
        }

        // --- ÙˆØ¸ÙŠÙØ© Ø§Ù„Ø®Ø±ÙˆØ¬ ---
        function logoutPlayer() {
            if(!myId) return;
            const code = myId.split('_')[1];
            
            rootRef.child('access_codes/' + code).update({ status: 'waiting', taken_by: null });
            rootRef.child('players/' + myId).remove();
            
            localStorage.removeItem('quiz_player_id');
            location.reload();
        }

        // --- 4. Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ ---
        function initPlayer(name, id) {
            const playerRef = rootRef.child('players/' + id);
            
            playerRef.on('value', snap => {
                if (!snap.exists()) {
                    localStorage.removeItem('quiz_player_id');
                    alert('Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø¬Ù„Ø³Ø© Ø£Ùˆ ØªÙ… ØªØºÙŠÙŠØ± Ø§Ù„Ø£ÙƒÙˆØ§Ø¯.');
                    location.reload();
                }
            });

            playerRef.update({
                name: name,
                online: true,
            });
            playerRef.onDisconnect().update({ online: false }); 

            playerRef.child('score').on('value', snap => {
                document.getElementById('p-score-display').innerText = (snap.val() === null) ? 0 : snap.val();
            });

            rootRef.child('game_state').on('value', handleGameStateChange);
            rootRef.child('players').on('value', updateMiniLeaderboard);
        }

        function updateMiniLeaderboard(snap) {
            const container = document.getElementById('player-mini-leaderboard');
            let players = [];
            snap.forEach(c => players.push(c.val()));
            players.sort((a,b) => (b.score || 0) - (a.score || 0));
            
            // Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ†
            container.innerHTML = players.map((p, i) => 
                `<div class="inline-block px-3 py-1 bg-blue-800 rounded mr-1 border ${p.name === myName ? 'border-yellow-400' : 'border-blue-600'}">
                    <span class="text-yellow-300 font-bold">#${i+1}</span> ${p.name} <span class="text-xs font-mono">(${p.score || 0})</span>
                </div>`
            ).join('');
        }

        function handleGameStateChange(snapshot) {
            const state = snapshot.val();
            const qArea = document.getElementById('active-question-area');
            const waitMsg = document.getElementById('waiting-msg');
            const feedbackArea = document.getElementById('feedback-area');
            
            if (!state || state.status === 'waiting') {
                qArea.classList.add('hidden');
                waitMsg.classList.remove('hidden');
                updateStatus('waiting', 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø´Ø±Ù...');
                isButtonsLocked = false;
                return;
            }

            if (state.status === 'active' || state.status === 'locked') {
                waitMsg.classList.add('hidden');
                qArea.classList.remove('hidden');
                
                if (!currentQuestionData || currentQuestionData.id !== state.question.id) {
                    currentQuestionData = state.question;
                    renderOptions(state.question);
                    updateStatus('active', 'Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¨Ø³Ø±Ø¹Ø©!');
                    feedbackArea.classList.add('hidden');
                }

                if (state.buzzed_by) {
                    isButtonsLocked = true;
                    disableAllButtons();
                    
                    if (state.buzzed_by === myId) {
                         if (!state.last_result) {
                            updateStatus('info', 'Ù„Ù‚Ø¯ Ø£Ø¬Ø¨Øª! Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù‚Ù‚...');
                         }
                    } else {
                         updateStatus('locked', 'Ø³Ø¨Ù‚Ùƒ Ù…Ù†Ø§ÙØ³ Ø¢Ø®Ø±!');
                    }

                    if (state.last_result) {
                        feedbackArea.classList.remove('hidden');
                        const r = state.last_result;
                        let msgHTML = "";

                        if (state.buzzed_by === myId) {
                            if (r.correct) {
                                feedbackArea.className = 'p-4 rounded-lg text-center font-bold text-sm mb-2 animate-pop border shadow-md bg-green-100 text-green-900 border-green-300';
                                msgHTML = `ğŸ‰ Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©!<br>Ø§Ø®ØªØ±Øª: <b>${r.selected_text}</b><br>Ø§Ù„Ø±ØµÙŠØ¯: +10`;
                                updateStatus('success', 'Ø£Ø­Ø³Ù†Øª! Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©');
                            } else {
                                feedbackArea.className = 'p-4 rounded-lg text-center font-bold text-sm mb-2 animate-pop border shadow-md bg-red-100 text-red-900 border-red-300';
                                msgHTML = `âŒ Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©!<br>Ø§Ø®ØªØ±Øª: <b>${r.selected_text}</b><br>Ø§Ù„ØµØ­ÙŠØ­: <b>${r.correct_text}</b><br>Ø§Ù„Ø±ØµÙŠØ¯: -10`;
                                updateStatus('error', 'Ù„Ù„Ø£Ø³Ù! Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø©');
                            }
                        } else {
                            feedbackArea.className = 'p-4 rounded-lg text-center font-bold text-sm mb-2 animate-pop border shadow-md bg-blue-50 text-gray-800 border-blue-200';
                            const verdict = r.correct ? '<span class="text-green-600 font-black">ØµØ­ÙŠØ­Ø©</span>' : '<span class="text-red-600 font-black">Ø®Ø§Ø·Ø¦Ø©</span>';
                            msgHTML = `Ø£Ø¬Ø§Ø¨ <b>${r.name}</b>: <b>${r.selected_text}</b> (${verdict})<br>Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©: <b>${r.correct_text}</b>`;
                        }
                        feedbackArea.innerHTML = msgHTML;
                    }

                } else {
                    isButtonsLocked = false;
                    enableAllButtons();
                }
            }
        }

        function renderOptions(question) {
            document.getElementById('q-text').innerText = question.text;
            const container = document.getElementById('options-container');
            container.innerHTML = '';

            question.options.forEach((opt, index) => {
                const btn = document.createElement('button');
                btn.className = 'btn-option w-full bg-white border-2 border-gray-200 p-4 rounded-xl text-lg font-bold shadow-sm hover:border-blue-400 hover:bg-blue-50 focus:bg-blue-100 mb-2';
                btn.innerText = opt;
                btn.onclick = () => handleOptionClick(index);
                container.appendChild(btn);
            });
        }

        function handleOptionClick(selectedIndex) {
            if (isButtonsLocked) return;

            rootRef.child('game_state/buzzed_by').transaction((currentData) => {
                if (currentData === null) {
                    return myId; 
                } else {
                    return; 
                }
            }, (error, committed, snapshot) => {
                if (committed) {
                    checkAnswer(selectedIndex);
                } else {
                    isButtonsLocked = true;
                    disableAllButtons();
                }
            });
        }

        function checkAnswer(selectedIndex) {
            const isCorrect = (selectedIndex === currentQuestionData.correctIndex);
            const points = isCorrect ? 10 : -10;
            
            const selectedText = currentQuestionData.options[selectedIndex];
            const correctText = currentQuestionData.options[currentQuestionData.correctIndex];
            
            rootRef.child('players/' + myId + '/score').transaction(score => (score || 0) + points);

            const resultData = {
                name: myName,
                correct: isCorrect,
                points: points,
                selected_text: selectedText,
                correct_text: correctText,
                question_text: currentQuestionData.text,
                timestamp: Date.now()
            };

            // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
            rootRef.child('game_state').update({
                last_result: resultData
            });

            // Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø³Ø¬Ù„ Ø§Ù„Ø¯Ø§Ø¦Ù…
            rootRef.child('history_log').push(resultData);
        }

        function disableAllButtons() {
            const btns = document.querySelectorAll('.btn-option');
            btns.forEach(b => {
                b.disabled = true;
                b.classList.add('opacity-50', 'cursor-not-allowed');
            });
        }
        function enableAllButtons() {
            const btns = document.querySelectorAll('.btn-option');
            btns.forEach(b => {
                b.disabled = false;
                b.classList.remove('opacity-50', 'cursor-not-allowed');
            });
        }
        function updateStatus(type, msg) {
            const bar = document.getElementById('status-bar');
            bar.innerText = msg;
            bar.className = 'absolute bottom-0 w-full p-3 text-center text-white text-sm font-bold transition-colors duration-300 z-20 ';
            if(type === 'waiting') bar.classList.add('bg-gray-500');
            if(type === 'active') bar.classList.add('bg-blue-600');
            if(type === 'locked') bar.classList.add('bg-red-400');
            if(type === 'success') bar.classList.add('bg-green-600');
            if(type === 'error') bar.classList.add('bg-red-600');
            if(type === 'info') bar.classList.add('bg-yellow-600');
        }

        // --- 6. Ù…Ù†Ø·Ù‚ Ø§Ù„Ù…Ø´Ø±Ù (Ù…Ø¹ Ù…ÙŠØ²Ø§Øª Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù) ---
        function initAdmin() {
            rootRef.child('players').on('value', snap => {
                const list = document.getElementById('admin-players-list');
                list.innerHTML = '';
                snap.forEach(p => {
                    const val = p.val();
                    const li = document.createElement('li');
                    li.className = 'flex justify-between bg-gray-700 p-2 rounded';
                    li.innerHTML = `<span>${val.name} <span class="${val.online ? 'text-green-400':'text-red-400'}">â—</span></span> <span>${val.score || 0}</span>`;
                    list.appendChild(li);
                });
            });

            rootRef.child('access_codes').on('value', snap => {
                const container = document.getElementById('admin-codes-display');
                container.innerHTML = '';
                if(snap.exists()) {
                    snap.forEach(codeSnap => {
                        const code = codeSnap.key;
                        const status = codeSnap.val().status;
                        const taker = codeSnap.val().taken_by || '';
                        const div = document.createElement('div');
                        div.className = `p-1 rounded ${status === 'waiting' ? 'bg-yellow-600' : 'bg-gray-600'} relative group`;
                        const deleteBtn = `<button onclick="adminDeleteCode('${code}')" class="absolute -top-2 -right-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs opacity-0 group-hover:opacity-100 shadow">Ã—</button>`;
                        div.innerHTML = `${deleteBtn}<b>${code}</b><br><span class="text-xs">${status==='waiting'?'Ù…ØªØ§Ø­':taker}</span>`;
                        container.appendChild(div);
                    });
                }
            });

            rootRef.child('question_bank').on('value', snap => {
                const list = document.getElementById('admin-bank-list');
                list.innerHTML = '';
                snap.forEach(qSnap => {
                    const q = qSnap.val();
                    const isAsked = q.was_asked === true;
                    
                    const div = document.createElement('div');
                    div.className = `flex flex-col bg-gray-700 p-2 rounded text-xs border-l-4 ${isAsked ? 'border-gray-500 opacity-70' : 'border-blue-500'}`;
                    
                    // Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¹Ù„ÙˆÙŠ: Ø§Ù„Ù†Øµ ÙˆØ§Ù„Ø£Ø²Ø±Ø§Ø±
                    const topRow = document.createElement('div');
                    topRow.className = 'flex justify-between items-start mb-1';
                    
                    const btns = document.createElement('div');
                    btns.className = 'flex gap-1 min-w-[120px] justify-end';

                    const publishBtn = isAsked 
                        ? `<button disabled class="bg-gray-500 text-gray-300 px-2 py-1 rounded cursor-not-allowed text-[10px]">Ù…Ù†Ø´ÙˆØ±</button>`
                        : `<button onclick="adminPublishQuestion('${qSnap.key}')" class="bg-blue-600 px-2 py-1 rounded hover:bg-blue-500 text-white">Ù†Ø´Ø±</button>`;
                    
                    const editBtn = `<button onclick="adminEditQuestion('${qSnap.key}')" class="bg-yellow-600 px-2 py-1 rounded hover:bg-yellow-500 text-white">ØªØ¹Ø¯ÙŠÙ„</button>`;
                    const deleteBtn = `<button onclick="adminDeleteQuestion('${qSnap.key}')" class="bg-red-600 px-2 py-1 rounded hover:bg-red-500 text-white">Ø­Ø°Ù</button>`;

                    btns.innerHTML = `${publishBtn} ${editBtn} ${deleteBtn}`;
                    topRow.innerHTML = `<span class="truncate w-1/2 font-bold">${q.text}</span>`;
                    topRow.appendChild(btns);

                    div.appendChild(topRow);
                    list.appendChild(div);
                });
            });
        }

        function adminGenerateCodes() {
            if(!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† ÙˆØ§Ù„Ø£ÙƒÙˆØ§Ø¯ ÙˆØ§Ù„Ø³Ø¬Ù„!')) return;

            const count = parseInt(document.getElementById('admin-players-count').value);
            if (!count || count <= 0) return alert('Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯Ø§Ù‹ ØµØ­ÙŠØ­Ø§Ù‹');
            
            rootRef.child('access_codes').remove();
            rootRef.child('players').remove();
            rootRef.child('history_log').remove(); // Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„
            rootRef.child('game_state').set({ status: 'waiting' });
            
            const updates = {};
            for(let i=0; i<count; i++) {
                const code = Math.floor(1000 + Math.random() * 9000);
                updates[code] = { status: 'waiting' };
            }
            rootRef.child('access_codes').update(updates);
        }

        function adminAddCodes() {
            const count = parseInt(document.getElementById('admin-players-count').value);
            if (!count || count <= 0) return alert('Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯Ø§Ù‹ ØµØ­ÙŠØ­Ø§Ù‹');
            
            const updates = {};
            for(let i=0; i<count; i++) {
                const code = Math.floor(1000 + Math.random() * 9000);
                updates[code] = { status: 'waiting' };
            }
            rootRef.child('access_codes').update(updates);
        }

        function adminDeleteCode(code) {
            if(confirm('Ø­Ø°Ù Ø§Ù„ÙƒÙˆØ¯ '+code+'ØŸ')) {
                rootRef.child('access_codes/' + code).remove();
                rootRef.child('players/player_' + code).remove();
            }
        }

        // --- ÙˆØ¸Ø§Ø¦Ù Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØ§Ù„Ø­Ø°Ù Ù„Ù„Ø£Ø³Ø¦Ù„Ø© ---
        function adminAddToBank() {
            const text = document.getElementById('admin-q-text').value;
            const optsStr = document.getElementById('admin-q-options').value;
            const correct = parseInt(document.getElementById('admin-q-correct').value);

            if(!text || !optsStr) return alert('Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
            const options = optsStr.split('ØŒ').length > 1 ? optsStr.split('ØŒ') : optsStr.split(',');

            const qData = {
                text: text,
                options: options.map(s => s.trim()),
                correctIndex: correct,
                was_asked: false 
            };

            if (editingQuestionKey) {
                // ÙˆØ¶Ø¹ Ø§Ù„ØªØ­Ø¯ÙŠØ«
                rootRef.child('question_bank/' + editingQuestionKey).update(qData);
                resetAdminForm();
            } else {
                // ÙˆØ¶Ø¹ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
                rootRef.child('question_bank').push(qData);
                resetAdminForm();
            }
        }

        function adminEditQuestion(key) {
            rootRef.child('question_bank/' + key).once('value', snap => {
                const q = snap.val();
                document.getElementById('admin-q-text').value = q.text;
                document.getElementById('admin-q-options').value = q.options.join('ØŒ ');
                document.getElementById('admin-q-correct').value = q.correctIndex;
                
                editingQuestionKey = key;
                
                // ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø²Ø±
                const btn = document.getElementById('btn-add-bank');
                btn.innerText = 'Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª';
                btn.className = 'flex-1 bg-orange-600 p-2 rounded font-bold hover:bg-orange-500 transition-colors';
                document.getElementById('btn-cancel-edit').classList.remove('hidden');
            });
        }

        function adminDeleteQuestion(key) {
            if(confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„ØŸ')) {
                rootRef.child('question_bank/' + key).remove();
                if(editingQuestionKey === key) resetAdminForm();
            }
        }

        function resetAdminForm() {
            document.getElementById('admin-q-text').value = '';
            document.getElementById('admin-q-options').value = '';
            document.getElementById('admin-q-correct').value = '';
            editingQuestionKey = null;
            
            const btn = document.getElementById('btn-add-bank');
            btn.innerText = 'Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø¨Ù†Ùƒ';
            btn.className = 'flex-1 bg-purple-600 p-2 rounded font-bold hover:bg-purple-500 transition-colors';
            document.getElementById('btn-cancel-edit').classList.add('hidden');
        }

        function adminResetBankStatus() {
            if(!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ø¹Ø§Ø¯Ø© ØªÙØ¹ÙŠÙ„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù„ØªØµØ¨Ø­ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ù†Ø´Ø± Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ØŸ')) return;
            rootRef.child('question_bank').once('value', snap => {
                snap.forEach(q => {
                    q.ref.update({ was_asked: false });
                });
            });
        }

        function adminPublishQuestion(qKey) {
            rootRef.child('question_bank/'+qKey).once('value').then(snap => {
                const qData = snap.val();
                qData.id = Date.now();
                
                rootRef.child('question_bank/'+qKey).update({ was_asked: true });
                
                rootRef.child('game_state').set({
                    status: 'active',
                    question: qData,
                    buzzed_by: null,
                    last_result: null 
                });
            });
        }

        function adminResetRound() {
            rootRef.child('game_state').update({
                status: 'waiting',
                buzzed_by: null
            });
        }

        // --- 7. Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¬Ù…Ù‡ÙˆØ± (Ø§Ù„Ù…Ø­Ø³Ù†) ---
        function initAudience() {
            // Ù…Ø±Ø§Ù‚Ø¨Ø© Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
            rootRef.child('game_state').on('value', snap => {
                const state = snap.val();
                const qArea = document.getElementById('audience-q-area');
                const waitingArea = document.getElementById('audience-waiting');
                const overlay = document.getElementById('audience-result-overlay');
                
                if (state && state.status === 'active') {
                    waitingArea.classList.add('hidden');
                    qArea.classList.remove('hidden');
                    document.getElementById('audience-q-text').innerText = state.question.text;
                    const optsDiv = document.getElementById('audience-options');
                    optsDiv.innerHTML = state.question.options.map((o, i) => 
                        `<div class="bg-indigo-100 p-4 rounded-xl text-indigo-900 border-2 border-indigo-200">${o}</div>`
                    ).join('');
                } else {
                    waitingArea.classList.remove('hidden');
                    qArea.classList.add('hidden');
                }

                // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø© Ø¥Ø°Ø§ ØªÙˆÙØ±Øª
                if (state && state.last_result) {
                    const r = state.last_result;
                    overlay.classList.remove('hidden');
                    const box = document.getElementById('audience-result-box');
                    
                    if (r.correct) {
                        box.className = 'bg-white text-black p-8 rounded-2xl shadow-2xl text-center border-4 border-green-500 transform scale-110';
                        box.innerHTML = `<h2 class="text-4xl font-bold text-green-600 mb-2">Ø¥Ø¬Ø§Ø¨Ø© ØµØ­ÙŠØ­Ø©! ğŸ‰</h2>
                                         <p class="text-2xl">Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚: <b>${r.name}</b></p>
                                         <p class="text-xl mt-2">Ø­ØµÙ„ Ø¹Ù„Ù‰ <b>10+</b> Ù†Ù‚Ø§Ø·</p>`;
                    } else {
                        box.className = 'bg-white text-black p-8 rounded-2xl shadow-2xl text-center border-4 border-red-500 transform scale-110';
                        box.innerHTML = `<h2 class="text-4xl font-bold text-red-600 mb-2">Ø¥Ø¬Ø§Ø¨Ø© Ø®Ø§Ø·Ø¦Ø© âŒ</h2>
                                         <p class="text-2xl">Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚: <b>${r.name}</b></p>
                                         <p class="text-lg mt-2 text-gray-600">Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© ÙƒØ§Ù†Øª: ${r.correct_text}</p>`;
                    }

                    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù€ Overlay Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†ÙŠ
                    setTimeout(() => {
                        overlay.classList.add('hidden');
                    }, 5000);
                } else {
                    overlay.classList.add('hidden');
                }
            });
            
            // ØªØ­Ø¯ÙŠØ« Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØªØ³Ø§Ø¨Ù‚ÙŠÙ† (Ø§Ù„ÙƒÙ„)
            rootRef.child('players').on('value', snap => {
                const board = document.getElementById('audience-leaderboard');
                if (!snap.exists()) { board.innerHTML = ''; return; }

                let players = [];
                snap.forEach(c => players.push(c.val()));
                players.sort((a,b) => (b.score || 0) - (a.score || 0));
                
                board.innerHTML = players.map((p, i) => 
                    `<div class="flex justify-between items-center p-3 rounded-xl mb-2 bg-white/10 hover:bg-white/20 transition">
                        <div class="flex items-center gap-3">
                            <span class="flex items-center justify-center w-8 h-8 rounded-full ${i===0?'bg-yellow-400 text-black font-black':'bg-indigo-700 text-white font-bold'}">${i+1}</span>
                            <span class="font-bold text-lg">${p.name}</span>
                        </div>
                        <span class="font-mono bg-black/30 px-3 py-1 rounded text-yellow-300 font-bold">${p.score || 0}</span>
                    </div>`
                ).join('');
            });

            // ØªØ­Ø¯ÙŠØ« Ø³Ø¬Ù„ Ø§Ù„Ø¬ÙˆÙ„Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© (History)
            rootRef.child('history_log').limitToLast(10).on('value', snap => {
                const list = document.getElementById('audience-history-list');
                list.innerHTML = '';
                const items = [];
                snap.forEach(child => items.push(child.val()));
                // Ø¹ÙƒØ³ Ø§Ù„ØªØ±ØªÙŠØ¨ Ù„ÙŠØ¸Ù‡Ø± Ø§Ù„Ø£Ø­Ø¯Ø« ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰
                items.reverse().forEach(h => {
                    const div = document.createElement('div');
                    div.className = `p-2 rounded mb-2 text-xs border-r-4 ${h.correct ? 'bg-green-900/40 border-green-500' : 'bg-red-900/40 border-red-500'}`;
                    div.innerHTML = `
                        <div class="flex justify-between font-bold text-white">
                            <span>${h.name}</span>
                            <span>${h.correct ? '+10' : '-10'}</span>
                        </div>
                        <div class="text-gray-300 truncate mt-1" title="${h.question_text}">${h.question_text}</div>
                    `;
                    list.appendChild(div);
                });
            });
        }

    </script>
</body>
</html>
